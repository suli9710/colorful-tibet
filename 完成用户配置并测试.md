# 完成用户配置并测试连接

## ✅ 当前状态

您已经：
- ✅ 成功进入 MySQL
- ✅ 确认 `tibet_user` 用户存在

## 🔧 现在需要做的

### 步骤1：在当前的 MySQL 中重新设置密码和权限

您当前在 `mysql>` 提示符下，执行以下命令：

```sql
-- 确保使用mysql数据库
USE mysql;

-- 重新设置密码（使用您修改的密码）
ALTER USER 'tibet_user'@'localhost' IDENTIFIED BY 'lzh031224';

-- 确保数据库存在
CREATE DATABASE IF NOT EXISTS tibet_tourism CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- 重新授权
GRANT ALL PRIVILEGES ON tibet_tourism.* TO 'tibet_user'@'localhost';
GRANT ALL PRIVILEGES ON *.* TO 'tibet_user'@'localhost' WITH GRANT OPTION;

-- 刷新权限
FLUSH PRIVILEGES;

-- 验证用户信息
SELECT User, Host, plugin FROM user WHERE User='tibet_user';

-- 验证权限
SHOW GRANTS FOR 'tibet_user'@'localhost';

-- 退出
EXIT;
```

### 步骤2：重启 MySQL

执行 `EXIT;` 后，回到 shell，执行：

```bash
# 停止安全模式
sudo pkill mysqld
sudo pkill mysqld_safe

# 等待停止
sleep 3

# 正常启动MySQL
sudo systemctl start mysql

# 等待启动
sleep 5

# 检查状态
sudo systemctl status mysql
```

### 步骤3：测试连接

```bash
mysql -u tibet_user -p tibet_tourism
```

**输入密码**：`lzh031224`

如果成功，您会看到：
```
Welcome to the MySQL monitor...
mysql>
```

### 步骤4：验证数据库

在 MySQL 中执行：

```sql
SHOW DATABASES;
USE tibet_tourism;
SHOW TABLES;
EXIT;
```

## 🎯 如果还是连接失败

### 检查认证插件

在安全模式下：

```bash
mysql -u root
```

```sql
USE mysql;
SELECT User, Host, plugin FROM user WHERE User='tibet_user';
```

如果 `plugin` 是 `auth_socket`，需要改为 `mysql_native_password`：

```sql
ALTER USER 'tibet_user'@'localhost' IDENTIFIED WITH mysql_native_password BY 'lzh031224';
FLUSH PRIVILEGES;
EXIT;
```

## 📝 配置 application.yml

现在您可以在配置文件中使用：

```yaml
spring:
  datasource:
    username: tibet_user
    password: lzh031224
```

## ✅ 完整操作流程

**在当前的 `mysql>` 提示符下执行：**

```sql
USE mysql;
ALTER USER 'tibet_user'@'localhost' IDENTIFIED BY 'lzh031224';
CREATE DATABASE IF NOT EXISTS tibet_tourism CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
GRANT ALL PRIVILEGES ON tibet_tourism.* TO 'tibet_user'@'localhost';
GRANT ALL PRIVILEGES ON *.* TO 'tibet_user'@'localhost' WITH GRANT OPTION;
FLUSH PRIVILEGES;
SELECT User, Host, plugin FROM user WHERE User='tibet_user';
EXIT;
```

**回到 shell 后执行：**

```bash
sudo pkill mysqld
sudo pkill mysqld_safe
sleep 3
sudo systemctl start mysql
sleep 5
mysql -u tibet_user -p tibet_tourism
# 输入密码：lzh031224
```

---

**现在在当前的 `mysql>` 提示符下执行上面的SQL命令，然后重启MySQL测试连接！**


