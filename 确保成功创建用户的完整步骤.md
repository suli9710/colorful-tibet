# 确保成功创建用户的完整步骤

## 🔍 当前问题

`tibet_user` 登录失败，说明用户可能没有成功创建。

## ✅ 完整解决步骤（一步一步来）

### 步骤1：确保 MySQL 完全停止

```bash
# 停止所有MySQL进程
sudo pkill mysqld 2>/dev/null
sudo pkill mysqld_safe 2>/dev/null
sudo systemctl stop mysql 2>/dev/null

# 等待几秒
sleep 3

# 确认没有MySQL进程在运行
ps aux | grep mysqld | grep -v grep
# 如果没有任何输出，说明MySQL已完全停止
```

### 步骤2：创建 socket 目录

```bash
sudo mkdir -p /var/run/mysqld
sudo chown mysql:mysql /var/run/mysqld
sudo chmod 755 /var/run/mysqld
```

### 步骤3：启动安全模式

```bash
sudo mysqld_safe --skip-grant-tables --skip-networking > /dev/null 2>&1 &

# 等待10秒，确保MySQL完全启动
sleep 10

# 检查MySQL是否在运行
ps aux | grep mysqld | grep -v grep
# 应该看到 mysqld 和 mysqld_safe 进程
```

### 步骤4：进入 MySQL 并验证

```bash
mysql -u root
```

**重要**：必须看到 `mysql>` 提示符！

### 步骤5：在 MySQL 中执行（完整命令）

在 `mysql>` 提示符下，**一次性复制粘贴以下所有内容**：

```sql
USE mysql;
SHOW DATABASES;
CREATE DATABASE IF NOT EXISTS tibet_tourism CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
DROP USER IF EXISTS 'tibet_user'@'localhost';
CREATE USER 'tibet_user'@'localhost' IDENTIFIED BY 'lzh031224';
GRANT ALL PRIVILEGES ON tibet_tourism.* TO 'tibet_user'@'localhost';
GRANT ALL PRIVILEGES ON *.* TO 'tibet_user'@'localhost' WITH GRANT OPTION;
FLUSH PRIVILEGES;
SELECT User, Host, plugin FROM user WHERE User='tibet_user';
SHOW GRANTS FOR 'tibet_user'@'localhost';
EXIT;
```

**注意**：
- 每行命令后面都有分号 `;`
- 看到 `mysql>` 提示符说明在MySQL中
- 执行后应该看到用户信息和权限信息

### 步骤6：重启 MySQL

执行 `EXIT;` 后，回到 shell：

```bash
# 停止安全模式
sudo pkill mysqld
sudo pkill mysqld_safe

# 等待停止
sleep 3

# 正常启动
sudo systemctl start mysql

# 等待启动
sleep 5

# 检查状态
sudo systemctl status mysql
# 应该显示：active (running)
```

### 步骤7：测试连接

```bash
mysql -u tibet_user -p tibet_tourism
```

**输入密码**：`lzh031224`

**如果成功**，您会看到：
```
Welcome to the MySQL monitor...
mysql>
```

## 🎯 如果还是失败

### 检查1：确认用户是否存在

在安全模式下：

```bash
mysql -u root
```

```sql
USE mysql;
SELECT User, Host FROM user WHERE User='tibet_user';
```

如果没有输出，说明用户不存在。

### 检查2：确认密码是否正确

在安全模式下重新设置密码：

```bash
mysql -u root
```

```sql
USE mysql;
ALTER USER 'tibet_user'@'localhost' IDENTIFIED BY '031224';
FLUSH PRIVILEGES;
EXIT;
```

### 检查3：使用更简单的密码

如果特殊字符有问题，可以使用纯字母数字密码：

```sql
CREATE USER 'tibet_user'@'localhost' IDENTIFIED BY 'Tibet2024';
```

然后测试：
```bash
mysql -u tibet_user -p tibet_tourism
# 输入密码：Tibet2024
```

## 📋 完整命令序列（复制执行）

```bash
# === 1. 停止MySQL ===
sudo pkill mysqld 2>/dev/null
sudo pkill mysqld_safe 2>/dev/null
sudo systemctl stop mysql 2>/dev/null
sleep 3

# === 2. 创建socket目录 ===
sudo mkdir -p /var/run/mysqld
sudo chown mysql:mysql /var/run/mysqld
sudo chmod 755 /var/run/mysqld

# === 3. 启动安全模式 ===
sudo mysqld_safe --skip-grant-tables --skip-networking > /dev/null 2>&1 &
sleep 10

# === 4. 进入MySQL ===
mysql -u root
```

**在 `mysql>` 提示符下执行：**

```sql
USE mysql;
CREATE DATABASE IF NOT EXISTS tibet_tourism CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
DROP USER IF EXISTS 'tibet_user'@'localhost';
CREATE USER 'tibet_user'@'localhost' IDENTIFIED BY 'Tibet2024!Tourism';
GRANT ALL PRIVILEGES ON tibet_tourism.* TO 'tibet_user'@'localhost';
GRANT ALL PRIVILEGES ON *.* TO 'tibet_user'@'localhost' WITH GRANT OPTION;
FLUSH PRIVILEGES;
SELECT User, Host FROM user WHERE User='tibet_user';
EXIT;
```

**回到 shell 后执行：**

```bash
# === 5. 重启MySQL ===
sudo pkill mysqld
sudo pkill mysqld_safe
sleep 3
sudo systemctl start mysql
sleep 5

# === 6. 测试连接 ===
mysql -u tibet_user -p tibet_tourism
# 输入密码：Tibet2024!Tourism
```

## ⚠️ 重要提示

1. **确保在 `mysql>` 提示符下执行 SQL 命令**
2. **每行命令后面要加分号 `;`**
3. **密码是：`Tibet2024!Tourism`（注意大小写和特殊字符）**
4. **如果特殊字符有问题，可以改用：`Tibet2024`**

---

**按照上面的步骤，一步一步执行，应该就能成功创建用户了！**


