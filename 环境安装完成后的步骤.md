# ç¯å¢ƒå®‰è£…å®Œæˆåçš„éƒ¨ç½²æ­¥éª¤

## âœ… ç¬¬ä¸€æ­¥ï¼šéªŒè¯ç¯å¢ƒå®‰è£…

åœ¨æœåŠ¡å™¨ç»ˆç«¯æ‰§è¡Œï¼Œç¡®è®¤æ‰€æœ‰è½¯ä»¶å·²å®‰è£…ï¼š

```bash
# æ£€æŸ¥Java
java -version
# åº”è¯¥æ˜¾ç¤ºï¼šopenjdk version "17.0.x"

# æ£€æŸ¥Maven
mvn -version

# æ£€æŸ¥Node.js
node -v
npm -v

# æ£€æŸ¥MySQL
mysql --version
systemctl status mysql

# æ£€æŸ¥Nginx
nginx -v
systemctl status nginx
```

## ğŸ“¤ ç¬¬äºŒæ­¥ï¼šä¸Šä¼ é¡¹ç›®ä»£ç 

### æ–¹æ³•1ï¼šä½¿ç”¨SCPä¸Šä¼ ï¼ˆæ¨èï¼‰

åœ¨æ‚¨çš„ç”µè„‘ä¸Šï¼ˆCMDæˆ–PowerShellï¼‰æ‰§è¡Œï¼š

```cmd
# ä¸Šä¼ åç«¯
scp -r C:\Users\Suli\Desktop\colorful-tibet\backend ubuntu@1.15.29.168:/opt/colorful-tibet/

# ä¸Šä¼ å‰ç«¯
scp -r C:\Users\Suli\Desktop\colorful-tibet\frontend ubuntu@1.15.29.168:/opt/colorful-tibet/
```

### æ–¹æ³•2ï¼šä½¿ç”¨WinSCPä¸Šä¼ 

1. æ‰“å¼€WinSCPï¼Œè¿æ¥åˆ°æœåŠ¡å™¨
2. å·¦ä¾§ï¼šæ‰¾åˆ°é¡¹ç›®æ–‡ä»¶å¤¹
3. å³ä¾§ï¼šè¿›å…¥ `/opt/colorful-tibet/`
4. æ‹–æ‹½ `backend` å’Œ `frontend` æ–‡ä»¶å¤¹åˆ°å³ä¾§

### æ–¹æ³•3ï¼šä½¿ç”¨Gitï¼ˆå¦‚æœæœ‰ä»“åº“ï¼‰

```bash
cd /opt/colorful-tibet
git clone https://your-repo-url.git .
```

## âš™ï¸ ç¬¬ä¸‰æ­¥ï¼šé…ç½®åç«¯

### 3.1 ç¼–è¾‘é…ç½®æ–‡ä»¶

```bash
cd /opt/colorful-tibet/backend
nano src/main/resources/application.yml
```

### 3.2 ä¿®æ”¹æ•°æ®åº“é…ç½®

æ‰¾åˆ°ä»¥ä¸‹éƒ¨åˆ†å¹¶ä¿®æ”¹ï¼š

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/tibet_tourism?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
    username: tibet_user
    password: æ‚¨çš„æ•°æ®åº“å¯†ç   # æ›¿æ¢ä¸ºå®é™…å¯†ç 
    driver-class-name: com.mysql.cj.jdbc.Driver
  jpa:
    database-platform: org.hibernate.dialect.MySQL8Dialect
    hibernate:
      ddl-auto: update  # æ”¹ä¸º update
    show-sql: false  # ç”Ÿäº§ç¯å¢ƒå…³é—­SQLæ—¥å¿—
  h2:
    console:
      enabled: false  # å…³é—­H2æ§åˆ¶å°
```

### 3.3 é…ç½®è±†åŒ…APIï¼ˆå¦‚æœéœ€è¦ï¼‰

```yaml
doubao:
  api:
    url: https://ark.cn-beijing.volces.com/api/v3/chat/completions
    key: æ‚¨çš„APIå¯†é’¥  # æ›¿æ¢ä¸ºå®é™…å¯†é’¥
    model: æ‚¨çš„æ¨¡å‹åç§°  # æ›¿æ¢ä¸ºå®é™…æ¨¡å‹
```

ä¿å­˜æ–‡ä»¶ï¼šæŒ‰ `Ctrl + O`ï¼Œç„¶å `Enter`ï¼Œå†æŒ‰ `Ctrl + X` é€€å‡º

## ğŸ”¨ ç¬¬å››æ­¥ï¼šç¼–è¯‘å’Œå¯åŠ¨åç«¯

### 4.1 ç¼–è¯‘é¡¹ç›®

```bash
cd /opt/colorful-tibet/backend
mvn clean package -DskipTests
```

ç­‰å¾…ç¼–è¯‘å®Œæˆï¼ˆå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼‰

### 4.2 åˆ›å»ºç³»ç»ŸæœåŠ¡ï¼ˆæ¨èï¼‰

```bash
sudo nano /etc/systemd/system/tibet-backend.service
```

ç²˜è´´ä»¥ä¸‹å†…å®¹ï¼š

```ini
[Unit]
Description=Colorful Tibet Backend Service
After=network.target mysql.service

[Service]
Type=simple
User=root
WorkingDirectory=/opt/colorful-tibet/backend
ExecStart=/usr/bin/java -jar -Xms512m -Xmx2048m /opt/colorful-tibet/backend/target/tourism-0.0.1-SNAPSHOT.jar
Restart=always
RestartSec=10
StandardOutput=append:/opt/colorful-tibet/logs/backend.log
StandardError=append:/opt/colorful-tibet/logs/backend.log

[Install]
WantedBy=multi-user.target
```

ä¿å­˜å¹¶é€€å‡ºï¼Œç„¶åï¼š

```bash
# é‡æ–°åŠ è½½systemd
sudo systemctl daemon-reload

# å¯åŠ¨æœåŠ¡
sudo systemctl start tibet-backend

# è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl enable tibet-backend

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status tibet-backend
```

### 4.3 éªŒè¯åç«¯è¿è¡Œ

```bash
# æ£€æŸ¥ç«¯å£
netstat -tlnp | grep 8080

# æµ‹è¯•API
curl http://localhost:8080/api/spots
```

## ğŸ¨ ç¬¬äº”æ­¥ï¼šæ„å»ºå‰ç«¯

```bash
cd /opt/colorful-tibet/frontend

# å®‰è£…ä¾èµ–
npm install

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build
```

æ„å»ºå®Œæˆåï¼Œé™æ€æ–‡ä»¶åœ¨ `dist/` ç›®å½•

## ğŸŒ ç¬¬å…­æ­¥ï¼šé…ç½®Nginx

### 6.1 åˆ›å»ºNginxé…ç½®

```bash
sudo nano /etc/nginx/sites-available/colorful-tibet
```

ç²˜è´´ä»¥ä¸‹é…ç½®ï¼š

```nginx
upstream backend {
    server 127.0.0.1:8080;
    keepalive 64;
}

server {
    listen 80;
    server_name 1.15.29.168;  # æ›¿æ¢ä¸ºæ‚¨çš„åŸŸåæˆ–IP
    
    root /opt/colorful-tibet/frontend/dist;
    index index.html;
    
    # å‰ç«¯è·¯ç”±
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(jpg|jpeg|png|gif|ico|css|js|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
    
    # åç«¯APIä»£ç†
    location /api {
        proxy_pass http://backend;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        proxy_connect_timeout 120s;
        proxy_send_timeout 120s;
        proxy_read_timeout 120s;
    }
    
    # å›¾ç‰‡èµ„æºä»£ç†
    location /images {
        proxy_pass http://backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        expires 30d;
        add_header Cache-Control "public";
    }
    
    client_max_body_size 20M;
    
    # Gzipå‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript application/x-javascript application/xml+rss application/json application/javascript;
}
```

### 6.2 å¯ç”¨é…ç½®

```bash
# åˆ›å»ºç¬¦å·é“¾æ¥
sudo ln -s /etc/nginx/sites-available/colorful-tibet /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# å¦‚æœæµ‹è¯•é€šè¿‡ï¼Œé‡è½½Nginx
sudo systemctl reload nginx
```

## âœ… ç¬¬ä¸ƒæ­¥ï¼šéªŒè¯éƒ¨ç½²

### 7.1 æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# æ£€æŸ¥åç«¯
sudo systemctl status tibet-backend

# æ£€æŸ¥Nginx
sudo systemctl status nginx

# æ£€æŸ¥MySQL
sudo systemctl status mysql
```

### 7.2 è®¿é—®ç½‘ç«™

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š
- **ä½¿ç”¨IP**ï¼šhttp://1.15.29.168
- **ä½¿ç”¨åŸŸå**ï¼šhttp://your-domain.comï¼ˆå¦‚æœå·²é…ç½®ï¼‰

### 7.3 æŸ¥çœ‹æ—¥å¿—

```bash
# åç«¯æ—¥å¿—
tail -f /opt/colorful-tibet/logs/backend.log

# Nginxæ—¥å¿—
tail -f /var/log/nginx/colorful-tibet-access.log
tail -f /var/log/nginx/colorful-tibet-error.log
```

## ğŸ”’ ç¬¬å…«æ­¥ï¼šé…ç½®SSLè¯ä¹¦ï¼ˆå¯é€‰ï¼‰

å¦‚æœæœ‰åŸŸåï¼Œå¯ä»¥é…ç½®HTTPSï¼š

```bash
sudo certbot --nginx -d your-domain.com
```

## ğŸ“‹ å¿«é€Ÿæ£€æŸ¥æ¸…å•

- [ ] ç¯å¢ƒè½¯ä»¶å·²å®‰è£…ï¼ˆJava, Maven, Node.js, MySQL, Nginxï¼‰
- [ ] é¡¹ç›®ä»£ç å·²ä¸Šä¼ åˆ°æœåŠ¡å™¨
- [ ] åç«¯é…ç½®æ–‡ä»¶å·²ä¿®æ”¹ï¼ˆæ•°æ®åº“è¿æ¥ç­‰ï¼‰
- [ ] åç«¯å·²ç¼–è¯‘å¹¶å¯åŠ¨
- [ ] å‰ç«¯å·²æ„å»º
- [ ] Nginxå·²é…ç½®å¹¶è¿è¡Œ
- [ ] å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—®ç½‘ç«™
- [ ] APIæ¥å£æ­£å¸¸å“åº”

## ğŸ†˜ é‡åˆ°é—®é¢˜ï¼Ÿ

### åç«¯æ— æ³•å¯åŠ¨
```bash
# æŸ¥çœ‹æ—¥å¿—
tail -100 /opt/colorful-tibet/logs/backend.log
journalctl -u tibet-backend -n 50
```

### æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æµ‹è¯•è¿æ¥
mysql -u tibet_user -p tibet_tourism
```

### å‰ç«¯404é”™è¯¯
```bash
# æ£€æŸ¥Nginxé…ç½®
sudo nginx -t
# æ£€æŸ¥é™æ€æ–‡ä»¶
ls -lh /opt/colorful-tibet/frontend/dist/
```

## ğŸ“š è¯¦ç»†æ–‡æ¡£

- å®Œæ•´éƒ¨ç½²æ•™ç¨‹ï¼š`DEPLOYMENT_GUIDE.md`
- å¿«é€Ÿéƒ¨ç½²æŒ‡å—ï¼š`DEPLOYMENT_QUICK_START.md`

---

**å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œæ‚¨çš„ç½‘ç«™å°±å¯ä»¥æ­£å¸¸è®¿é—®äº†ï¼** ğŸ‰


