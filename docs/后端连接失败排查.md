# åç«¯è¿æ¥å¤±è´¥æ’æŸ¥

## âŒ é”™è¯¯ï¼šConnection reset by peer / Connection refused

### é—®é¢˜æè¿°

æµ‹è¯•åç«¯ API æ—¶å‡ºç°ï¼š
- `curl: (56) Recv failure: Connection reset by peer`
- `wget: can't connect to remote host (172.19.0.2): Connection refused`

### åŸå› 

- åç«¯æœåŠ¡æœªæ­£å¸¸å¯åŠ¨
- åç«¯æœåŠ¡å¯åŠ¨åå´©æºƒ
- åç«¯ç«¯å£æœªæ­£ç¡®ç›‘å¬
- åç«¯æœåŠ¡æ­£åœ¨å¯åŠ¨ä¸­

### è§£å†³æ–¹æ¡ˆ

#### æ­¥éª¤ 1ï¼šæ£€æŸ¥åç«¯å®¹å™¨çŠ¶æ€

```bash
# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker compose ps

# æŸ¥çœ‹åç«¯å®¹å™¨è¯¦ç»†ä¿¡æ¯
docker inspect colorful-tibet-backend | grep -A 10 "State"
```

#### æ­¥éª¤ 2ï¼šæŸ¥çœ‹åç«¯æ—¥å¿—

```bash
# æŸ¥çœ‹åç«¯å®Œæ•´æ—¥å¿—
docker compose logs backend

# æŸ¥çœ‹æœ€å 50 è¡Œæ—¥å¿—
docker compose logs backend | tail -50

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
docker compose logs -f backend
```

#### æ­¥éª¤ 3ï¼šæ£€æŸ¥åç«¯è¿›ç¨‹

```bash
# æ£€æŸ¥å®¹å™¨å†…æ˜¯å¦æœ‰ Java è¿›ç¨‹
docker exec colorful-tibet-backend ps aux

# æ£€æŸ¥ç«¯å£æ˜¯å¦ç›‘å¬
docker exec colorful-tibet-backend netstat -tlnp
```

#### æ­¥éª¤ 4ï¼šé‡å¯åç«¯æœåŠ¡

```bash
# é‡å¯åç«¯å®¹å™¨
docker compose restart backend

# ç­‰å¾…æœåŠ¡å¯åŠ¨ï¼ˆå¯èƒ½éœ€è¦ 30-60 ç§’ï¼‰
sleep 30

# å†æ¬¡æµ‹è¯•
curl http://localhost:8080/api/spots
```

#### æ­¥éª¤ 5ï¼šå¦‚æœä»ç„¶å¤±è´¥ï¼ŒæŸ¥çœ‹è¯¦ç»†é”™è¯¯

```bash
# æŸ¥çœ‹å®¹å™¨é€€å‡ºä»£ç 
docker inspect colorful-tibet-backend | grep -A 5 "State"

# æŸ¥çœ‹å®¹å™¨å®Œæ•´æ—¥å¿—
docker compose logs backend > backend.log 2>&1
cat backend.log
```

## ğŸ”§ å¿«é€Ÿä¿®å¤æ­¥éª¤

### æ–¹æ³•ä¸€ï¼šé‡å¯åç«¯æœåŠ¡

```bash
cd /opt/colorful-tibet

# åœæ­¢åç«¯
docker compose stop backend

# å¯åŠ¨åç«¯
docker compose start backend

# ç­‰å¾…å¯åŠ¨ï¼ˆSpring Boot éœ€è¦æ—¶é—´ï¼‰
sleep 30

# æµ‹è¯•
curl http://localhost:8080/api/spots
```

### æ–¹æ³•äºŒï¼šå®Œå…¨é‡å¯åç«¯

```bash
cd /opt/colorful-tibet

# åˆ é™¤å¹¶é‡æ–°åˆ›å»ºåç«¯å®¹å™¨
docker compose rm -f backend
docker compose up -d backend

# ç­‰å¾…å¯åŠ¨
sleep 30

# æŸ¥çœ‹æ—¥å¿—
docker compose logs -f backend
```

### æ–¹æ³•ä¸‰ï¼šæ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®

```bash
# æ£€æŸ¥ .env æ–‡ä»¶
cat /opt/colorful-tibet/.env

# æ£€æŸ¥åç«¯å®¹å™¨çš„ç¯å¢ƒå˜é‡
docker exec colorful-tibet-backend env | grep -E "DOUBAO|JWT|SPRING"
```

## ğŸ” å®Œæ•´è¯Šæ–­å‘½ä»¤

```bash
echo "=== 1. å®¹å™¨çŠ¶æ€ ==="
docker compose ps

echo "=== 2. åç«¯æ—¥å¿—ï¼ˆæœ€å 30 è¡Œï¼‰==="
docker compose logs backend | tail -30

echo "=== 3. å®¹å™¨å†…è¿›ç¨‹ ==="
docker exec colorful-tibet-backend ps aux 2>/dev/null || echo "å®¹å™¨å¯èƒ½å·²åœæ­¢"

echo "=== 4. å®¹å™¨å†…ç«¯å£ç›‘å¬ ==="
docker exec colorful-tibet-backend netstat -tlnp 2>/dev/null || echo "æ— æ³•æ£€æŸ¥ç«¯å£"

echo "=== 5. å®¹å™¨çŠ¶æ€è¯¦æƒ… ==="
docker inspect colorful-tibet-backend | grep -A 10 "State"

echo "=== 6. æµ‹è¯•åç«¯è¿æ¥ ==="
curl -v http://localhost:8080/api/spots 2>&1 | head -20
```

## âš ï¸ å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šåç«¯å¯åŠ¨å¤±è´¥

**æŸ¥çœ‹æ—¥å¿—æ‰¾å‡ºåŸå› **ï¼š
```bash
docker compose logs backend | grep -i error
docker compose logs backend | grep -i exception
docker compose logs backend | grep -i failed
```

### é—®é¢˜ 2ï¼šç¯å¢ƒå˜é‡ç¼ºå¤±

**æ£€æŸ¥é…ç½®**ï¼š
```bash
# æ£€æŸ¥ .env æ–‡ä»¶
cat .env

# æ£€æŸ¥å®¹å™¨ç¯å¢ƒå˜é‡
docker exec colorful-tibet-backend env
```

### é—®é¢˜ 3ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥

å¦‚æœä½¿ç”¨ MySQLï¼Œæ£€æŸ¥æ•°æ®åº“è¿æ¥ï¼š
```bash
# æŸ¥çœ‹æ—¥å¿—ä¸­çš„æ•°æ®åº“é”™è¯¯
docker compose logs backend | grep -i "database\|mysql\|connection"
```

### é—®é¢˜ 4ï¼šå†…å­˜ä¸è¶³

```bash
# æ£€æŸ¥ç³»ç»Ÿå†…å­˜
free -h

# æ£€æŸ¥å®¹å™¨èµ„æºä½¿ç”¨
docker stats --no-stream
```

## ğŸ“ æ¨èæ“ä½œé¡ºåº

```bash
# 1. æŸ¥çœ‹åç«¯æ—¥å¿—ï¼Œæ‰¾å‡ºé”™è¯¯åŸå› 
docker compose logs backend | tail -50

# 2. å¦‚æœçœ‹åˆ°é”™è¯¯ï¼Œæ ¹æ®é”™è¯¯ä¿¡æ¯ä¿®å¤

# 3. é‡å¯åç«¯
docker compose restart backend

# 4. ç­‰å¾…å¯åŠ¨ï¼ˆSpring Boot éœ€è¦æ—¶é—´ï¼‰
sleep 30

# 5. æµ‹è¯•
curl http://localhost:8080/api/spots

# 6. å¦‚æœæˆåŠŸï¼Œæµ‹è¯•å‰ç«¯
curl -I http://localhost
```

## ğŸ¯ æˆåŠŸæ ‡å¿—

ä¿®å¤æˆåŠŸåï¼š
- `docker compose ps` æ˜¾ç¤ºåç«¯çŠ¶æ€ä¸º `Up`ï¼ˆä¸æ˜¯ unhealthyï¼‰
- `curl http://localhost:8080/api/spots` è¿”å› JSON æ•°æ®
- `docker exec colorful-tibet-frontend wget -O- http://backend:8080/api/spots` æˆåŠŸ
- æµè§ˆå™¨è®¿é—®ç½‘ç«™ä¸å†æ˜¾ç¤º API è¿æ¥é”™è¯¯

