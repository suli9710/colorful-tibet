# 环境变量配置说明

## 📝 创建 .env 文件

在项目根目录创建 `.env` 文件：

```bash
cd /opt/colorful-tibet
nano .env
```

## 🔑 必需配置项

### 1. 豆包 API 配置

```env
# 豆包 API Key（必需）
DOUBAO_API_KEY=your-doubao-api-key

# 豆包 API URL（必需）
DOUBAO_API_URL=https://ark.cn-beijing.volces.com/api/v3/chat/completions

# 豆包模型名称（必需）
DOUBAO_MODEL=your-model-name
```

### 2. JWT 配置

```env
# JWT 密钥，用于生成和验证 JWT Token
# 生产环境请使用强随机字符串，建议至少 32 字符
# 生成方法: openssl rand -hex 32
JWT_SECRET=your-very-long-random-secret-key-at-least-32-characters
```

### 3. 管理员加密密钥

```env
# 用于加密管理员密码的密钥
# 生产环境请使用强随机字符串，建议至少 32 字符
# 生成方法: openssl rand -hex 32
ADMIN_ENCRYPTION_KEY=your-very-long-random-secret-key-at-least-32-characters
```

## 🔧 可选配置项

### 前端 API 地址

```env
# 前端访问后端的 API 地址
# 如果使用 Docker Compose，前端容器内可以通过 /api 访问后端
# 如果前端和后端分离部署，需要填写完整的 URL
VITE_API_BASE_URL=/api
# 或
VITE_API_BASE_URL=http://your-server-ip:8080/api
# 或（使用域名）
VITE_API_BASE_URL=https://your-domain.com/api
```

### Spring Profile

```env
# Spring Boot 配置文件
# local: 使用 H2 内存数据库（开发环境）
# prod: 使用 MySQL 数据库（生产环境）
SPRING_PROFILES_ACTIVE=local
```

### MySQL 数据库配置（如果使用 MySQL）

```env
# 数据库主机
DB_HOST=localhost
# 或使用 Docker Compose 服务名
DB_HOST=mysql

# 数据库端口
DB_PORT=3306

# 数据库名称
DB_NAME=tibet_tourism

# 数据库用户名
DB_USERNAME=tibet_user

# 数据库密码
DB_PASSWORD=your_strong_password
```

## 📋 完整配置示例

```env
# ============================================
# 豆包 API 配置（必需）
# ============================================
DOUBAO_API_KEY=e23d1e75-53b0-473d-92dc-8d70395b077b
DOUBAO_API_URL=https://ark.cn-beijing.volces.com/api/v3/chat/completions
DOUBAO_MODEL=ep-20251124231555-hdr7j

# ============================================
# JWT 配置（必需）
# ============================================
# 生成方法: openssl rand -hex 32
JWT_SECRET=a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6

# ============================================
# 管理员加密密钥（必需）
# ============================================
# 生成方法: openssl rand -hex 32
ADMIN_ENCRYPTION_KEY=z9y8x7w6v5u4t3s2r1q0p9o8n7m6l5k4j3i2h1g0f9e8d7c6b5a4

# ============================================
# 前端 API 地址（可选）
# ============================================
VITE_API_BASE_URL=/api

# ============================================
# Spring Profile（可选）
# ============================================
SPRING_PROFILES_ACTIVE=local

# ============================================
# MySQL 数据库配置（可选，如果使用 MySQL）
# ============================================
# DB_HOST=mysql
# DB_PORT=3306
# DB_NAME=tibet_tourism
# DB_USERNAME=tibet_user
# DB_PASSWORD=your_strong_password
```

## 🔐 安全建议

1. **不要使用默认密钥**：生产环境务必生成新的随机密钥
2. **保护 .env 文件**：确保 `.env` 文件权限正确，不要提交到 Git
3. **使用强密码**：数据库密码应使用强密码
4. **定期更换密钥**：定期更换 JWT_SECRET 和 ADMIN_ENCRYPTION_KEY

## 🛠️ 生成随机密钥

### 方法一：使用 OpenSSL

```bash
# 生成 32 字节（64 字符）的十六进制字符串
openssl rand -hex 32
```

### 方法二：使用 /dev/urandom

```bash
# 生成 32 字节的十六进制字符串
head -c 32 /dev/urandom | xxd -p -c 32
```

### 方法三：使用 Python

```bash
python3 -c "import secrets; print(secrets.token_hex(32))"
```

## 📝 验证配置

部署后，可以通过以下方式验证配置是否正确：

```bash
# 检查环境变量是否被正确读取
docker-compose config

# 查看后端日志，确认配置加载
docker-compose logs backend | grep -i "profile\|database\|jwt"

# 测试 API 是否正常
curl http://localhost:8080/api/spots
```

## ⚠️ 注意事项

1. **环境变量优先级**：Docker Compose 会优先使用 `.env` 文件中的值
2. **构建时变量**：`VITE_API_BASE_URL` 需要在构建时传入，修改后需要重新构建镜像
3. **运行时变量**：后端的环境变量可以在运行时修改，修改后重启容器即可
4. **敏感信息**：不要将 `.env` 文件提交到版本控制系统




