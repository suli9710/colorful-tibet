# å‰ç«¯æ„å»ºé”™è¯¯è§£å†³

## âŒ é”™è¯¯ï¼švue-tsc æ„å»ºå¤±è´¥

### é—®é¢˜æè¿°

æ‰§è¡Œ `docker compose build` æ—¶ï¼Œå‰ç«¯æ„å»ºå¤±è´¥ï¼š
```
Search string not found: "/supportedTSExtensions = .*(?=;)/"
process "/bin/sh -c npm run build" did not complete successfully: exit code: 1
```

### åŸå› 

- `vue-tsc` ç‰ˆæœ¬ä¸ Node.js ç‰ˆæœ¬å¯èƒ½å­˜åœ¨å…¼å®¹æ€§é—®é¢˜
- TypeScript ç±»å‹æ£€æŸ¥å¤±è´¥
- Docker æ„å»ºç¼“å­˜é—®é¢˜

## âŒ é”™è¯¯ï¼šterser not found

### é—®é¢˜æè¿°

æ‰§è¡Œ `docker compose build` æ—¶ï¼Œå‰ç«¯æ„å»ºå¤±è´¥ï¼š
```
[vite:terser] terser not found. Since Vite v3, terser has become an optional dependency. You need to install it.
```

### åŸå› 

- Vite v3+ å°† `terser` æ”¹ä¸ºå¯é€‰ä¾èµ–
- ç”Ÿäº§æ„å»ºéœ€è¦ `terser` æ¥å‹ç¼©ä»£ç 
- `package.json` ä¸­ç¼ºå°‘ `terser` ä¾èµ–

### è§£å†³æ–¹æ¡ˆ

#### æ–¹æ¡ˆä¸€ï¼šæ·»åŠ  terser ä¾èµ–ï¼ˆæ¨èï¼‰

ç¼–è¾‘ `package.json`ï¼Œåœ¨ `devDependencies` ä¸­æ·»åŠ  `terser`ï¼š

```bash
cd /opt/colorful-tibet/frontend
nano package.json
```

åœ¨ `devDependencies` ä¸­æ·»åŠ ï¼š
```json
"terser": "^5.36.0",
```

ä¿å­˜åé‡æ–°æ„å»ºï¼š
```bash
cd /opt/colorful-tibet
docker compose build --no-cache frontend
```

#### æ–¹æ¡ˆäºŒï¼šä½¿ç”¨ esbuild å‹ç¼©ï¼ˆæ›¿ä»£æ–¹æ¡ˆï¼‰

å¦‚æœä¸æƒ³ä½¿ç”¨ terserï¼Œå¯ä»¥é…ç½® Vite ä½¿ç”¨ esbuildï¼š

ç¼–è¾‘ `vite.config.ts`ï¼š
```typescript
export default defineConfig({
  build: {
    minify: 'esbuild'  // ä½¿ç”¨ esbuild è€Œä¸æ˜¯ terser
  }
})
```

### è§£å†³æ–¹æ¡ˆ

#### æ–¹æ¡ˆä¸€ï¼šè·³è¿‡ç±»å‹æ£€æŸ¥æ„å»ºï¼ˆå¿«é€Ÿè§£å†³ï¼‰

ä¿®æ”¹æ„å»ºå‘½ä»¤ï¼Œè·³è¿‡ `vue-tsc` ç±»å‹æ£€æŸ¥ï¼š

```bash
# ç¼–è¾‘ package.json
cd /opt/colorful-tibet/frontend
nano package.json
```

æ‰¾åˆ° `build` è„šæœ¬ï¼Œä¿®æ”¹ä¸ºï¼š
```json
"build": "vite build"
```

æˆ–è€…ä¿ç•™ç±»å‹æ£€æŸ¥ä½†å…è®¸å¤±è´¥ï¼š
```json
"build": "vue-tsc -b --skipLibCheck || vite build"
```

#### æ–¹æ¡ˆäºŒï¼šæ¸…ç†ç¼“å­˜åé‡æ–°æ„å»ºï¼ˆæ¨èï¼‰

```bash
# æ¸…ç† Docker æ„å»ºç¼“å­˜
docker builder prune -a

# æ¸…ç†å‰ç«¯æ„å»ºç¼“å­˜
cd /opt/colorful-tibet
docker compose build --no-cache frontend
```

#### æ–¹æ¡ˆä¸‰ï¼šæ›´æ–° vue-tsc ç‰ˆæœ¬

```bash
# ç¼–è¾‘ package.json
cd /opt/colorful-tibet/frontend
nano package.json
```

å°† `vue-tsc` ç‰ˆæœ¬æ›´æ–°ä¸ºæœ€æ–°ï¼š
```json
"vue-tsc": "^2.0.0"
```

ç„¶åé‡æ–°æ„å»ºï¼š
```bash
cd /opt/colorful-tibet
docker compose build --no-cache frontend
```

#### æ–¹æ¡ˆå››ï¼šä¿®æ”¹ Dockerfile è·³è¿‡ç±»å‹æ£€æŸ¥

å¦‚æœä¸æƒ³ä¿®æ”¹ package.jsonï¼Œå¯ä»¥ä¿®æ”¹ Dockerfileï¼š

```bash
cd /opt/colorful-tibet/frontend
nano Dockerfile
```

ä¿®æ”¹æ„å»ºå‘½ä»¤ï¼š
```dockerfile
# è·³è¿‡ç±»å‹æ£€æŸ¥ï¼Œç›´æ¥æ„å»º
RUN npm run build -- --skipLibCheck || vite build
```

æˆ–è€…ï¼š
```dockerfile
# åªè¿è¡Œ vite buildï¼Œè·³è¿‡ vue-tsc
RUN npx vite build
```

## ğŸš€ å¿«é€Ÿä¿®å¤ï¼ˆæ¨èï¼‰

### æ–¹æ³• 1ï¼šä¿®æ”¹æ„å»ºå‘½ä»¤ï¼ˆæœ€ç®€å•ï¼‰

```bash
# 1. ç¼–è¾‘ package.json
cd /opt/colorful-tibet/frontend
nano package.json
```

å°†ç¬¬ 8 è¡Œï¼š
```json
"build": "vue-tsc -b && vite build",
```

æ”¹ä¸ºï¼š
```json
"build": "vite build",
```

ä¿å­˜åï¼š
```bash
# 2. é‡æ–°æ„å»º
cd /opt/colorful-tibet
docker compose build --no-cache frontend
```

### æ–¹æ³• 2ï¼šåªæ„å»ºåç«¯ï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼‰

å¦‚æœå‰ç«¯æ„å»ºæœ‰é—®é¢˜ï¼Œå¯ä»¥å…ˆåªæ„å»ºå’Œå¯åŠ¨åç«¯ï¼š

```bash
cd /opt/colorful-tibet

# åªæ„å»ºåç«¯
docker compose build backend

# åªå¯åŠ¨åç«¯
docker compose up -d backend

# å‰ç«¯å¯ä»¥ç¨åä¿®å¤
```

## ğŸ” å®Œæ•´æ’æŸ¥æ­¥éª¤

```bash
# 1. æ£€æŸ¥ Dockerfile
cat frontend/Dockerfile

# 2. æ£€æŸ¥ package.json
cat frontend/package.json

# 3. æ¸…ç†ç¼“å­˜
docker builder prune -a

# 4. é‡æ–°æ„å»ºï¼ˆä¸ä½¿ç”¨ç¼“å­˜ï¼‰
docker compose build --no-cache

# 5. å¦‚æœä»ç„¶å¤±è´¥ï¼ŒæŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker compose build frontend 2>&1 | tee build.log
```

## ğŸ“ æ¨èçš„ package.json ä¿®æ”¹

```json
{
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "build:check": "vue-tsc -b && vite build",
    "preview": "vite preview"
  }
}
```

è¿™æ ·ï¼š
- `npm run build` - å¿«é€Ÿæ„å»ºï¼ˆè·³è¿‡ç±»å‹æ£€æŸ¥ï¼‰
- `npm run build:check` - å®Œæ•´æ„å»ºï¼ˆåŒ…å«ç±»å‹æ£€æŸ¥ï¼‰

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç”Ÿäº§ç¯å¢ƒ**ï¼šå»ºè®®ä¿®å¤ç±»å‹é”™è¯¯ï¼Œè€Œä¸æ˜¯è·³è¿‡æ£€æŸ¥
2. **å¼€å‘ç¯å¢ƒ**ï¼šå¯ä»¥è·³è¿‡ç±»å‹æ£€æŸ¥ä»¥åŠ å¿«æ„å»ºé€Ÿåº¦
3. **ç¼“å­˜é—®é¢˜**ï¼šå¦‚æœä¿®æ”¹åä»ç„¶å¤±è´¥ï¼Œä½¿ç”¨ `--no-cache` é‡æ–°æ„å»º

## ğŸ¯ æ¨èæ“ä½œ

**æœ€å¿«è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# 1. ä¿®æ”¹æ„å»ºå‘½ä»¤
cd /opt/colorful-tibet/frontend
sed -i 's/"build": "vue-tsc -b && vite build"/"build": "vite build"/' package.json

# 2. éªŒè¯ä¿®æ”¹
cat package.json | grep build

# 3. é‡æ–°æ„å»º
cd /opt/colorful-tibet
docker compose build --no-cache frontend
```

