# éƒ¨ç½²é—®é¢˜å®Œæ•´æ’æŸ¥æŒ‡å—

## ğŸ” é—®é¢˜æ’æŸ¥æ­¥éª¤

### æ­¥éª¤ 1ï¼šæ£€æŸ¥å®¹å™¨çŠ¶æ€

```bash
cd /opt/colorful-tibet
docker compose ps
```

**é¢„æœŸç»“æœ**ï¼š
- `colorful-tibet-backend` çŠ¶æ€åº”è¯¥æ˜¯ `Up` æˆ– `Up (unhealthy)`
- `colorful-tibet-frontend` çŠ¶æ€åº”è¯¥æ˜¯ `Up`

**å¦‚æœå®¹å™¨æ²¡æœ‰è¿è¡Œ**ï¼š
```bash
docker compose up -d
```

### æ­¥éª¤ 2ï¼šæ£€æŸ¥ç«¯å£å ç”¨

```bash
# æ£€æŸ¥ 80 ç«¯å£ï¼ˆå‰ç«¯ï¼‰
sudo netstat -tlnp | grep :80

# æ£€æŸ¥ 8080 ç«¯å£ï¼ˆåç«¯ï¼‰
sudo netstat -tlnp | grep :8080
```

**é¢„æœŸç»“æœ**ï¼š
- 80 ç«¯å£åº”è¯¥è¢« `colorful-tibet-frontend` å®¹å™¨å ç”¨
- 8080 ç«¯å£åº”è¯¥è¢« `colorful-tibet-backend` å®¹å™¨å ç”¨

**å¦‚æœç«¯å£è¢«å…¶ä»–æœåŠ¡å ç”¨**ï¼š
```bash
# åœæ­¢ç³»ç»Ÿ nginxï¼ˆå¦‚æœå ç”¨ 80 ç«¯å£ï¼‰
sudo systemctl stop nginx
sudo systemctl disable nginx

# é‡å¯ Docker æœåŠ¡
docker compose restart
```

### æ­¥éª¤ 3ï¼šæµ‹è¯•åç«¯ API

```bash
# åœ¨æœåŠ¡å™¨ä¸Šæµ‹è¯•
curl http://localhost:8080/api/spots

# ä»å¤–éƒ¨æµ‹è¯•ï¼ˆä½¿ç”¨æœåŠ¡å™¨ IPï¼‰
curl http://1.15.29.168:8080/api/spots
```

**é¢„æœŸç»“æœ**ï¼šåº”è¯¥è¿”å› JSON æ•°æ®

**å¦‚æœå¤±è´¥**ï¼š
```bash
# æŸ¥çœ‹åç«¯æ—¥å¿—
docker compose logs backend | tail -50

# æ£€æŸ¥åç«¯å®¹å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œ
docker exec colorful-tibet-backend ps aux
```

### æ­¥éª¤ 4ï¼šæµ‹è¯•å‰ç«¯

```bash
# åœ¨æœåŠ¡å™¨ä¸Šæµ‹è¯•
curl -I http://localhost

# æŸ¥çœ‹å‰ç«¯æ—¥å¿—
docker compose logs frontend | tail -30
```

**é¢„æœŸç»“æœ**ï¼šåº”è¯¥è¿”å› HTTP 200 çŠ¶æ€ç 

**å¦‚æœå¤±è´¥**ï¼š
```bash
# æ£€æŸ¥å‰ç«¯å®¹å™¨
docker exec colorful-tibet-frontend ls -la /usr/share/nginx/html

# æ£€æŸ¥ nginx é…ç½®
docker exec colorful-tibet-frontend cat /etc/nginx/conf.d/default.conf
```

### æ­¥éª¤ 5ï¼šæ£€æŸ¥é˜²ç«å¢™å’Œå®‰å…¨ç»„

```bash
# æ£€æŸ¥æœåŠ¡å™¨é˜²ç«å¢™
sudo ufw status

# æ£€æŸ¥ç«¯å£æ˜¯å¦å¼€æ”¾
sudo ufw allow 80/tcp
sudo ufw allow 8080/tcp
```

**è…¾è®¯äº‘å®‰å…¨ç»„é…ç½®**ï¼š
- ç™»å½•è…¾è®¯äº‘æ§åˆ¶å°
- è¿›å…¥äº‘æœåŠ¡å™¨ â†’ å®‰å…¨ç»„
- ç¡®ä¿å¼€æ”¾ä»¥ä¸‹ç«¯å£ï¼š
  - 80ï¼ˆHTTPï¼‰
  - 443ï¼ˆHTTPSï¼Œå¦‚æœä½¿ç”¨ï¼‰
  - 8080ï¼ˆåç«¯ APIï¼Œå¯é€‰ï¼‰

### æ­¥éª¤ 6ï¼šæ£€æŸ¥ Docker ç½‘ç»œ

```bash
# æ£€æŸ¥ Docker ç½‘ç»œ
docker network ls
docker network inspect colorful-tibet_default

# æ£€æŸ¥å®¹å™¨ IP
docker inspect colorful-tibet-backend | grep IPAddress
docker inspect colorful-tibet-frontend | grep IPAddress
```

## ğŸš¨ å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

### é—®é¢˜ 1ï¼šæµè§ˆå™¨æ˜¾ç¤º nginx é»˜è®¤é¡µé¢

**åŸå› **ï¼šç³»ç»Ÿ nginx å ç”¨ 80 ç«¯å£

**è§£å†³**ï¼š
```bash
sudo systemctl stop nginx
sudo systemctl disable nginx
docker compose restart frontend
```

### é—®é¢˜ 2ï¼šæ— æ³•è®¿é—®åç«¯ API

**åŸå› **ï¼šåç«¯æœåŠ¡æœªå¯åŠ¨æˆ–ç«¯å£æœªå¼€æ”¾

**è§£å†³**ï¼š
```bash
# æŸ¥çœ‹åç«¯æ—¥å¿—
docker compose logs backend

# é‡å¯åç«¯
docker compose restart backend

# æ£€æŸ¥ç«¯å£
sudo netstat -tlnp | grep 8080
```

### é—®é¢˜ 3ï¼šå‰ç«¯æ˜¾ç¤º 502 Bad Gateway

**åŸå› **ï¼šå‰ç«¯æ— æ³•è¿æ¥åˆ°åç«¯

**è§£å†³**ï¼š
```bash
# æ£€æŸ¥ docker-compose.yml ä¸­çš„ API åœ°å€é…ç½®
cat docker-compose.yml | grep VITE_API_BASE_URL

# æ£€æŸ¥å‰ç«¯ nginx é…ç½®
docker exec colorful-tibet-frontend cat /etc/nginx/conf.d/default.conf
```

### é—®é¢˜ 4ï¼šå‰ç«¯é¡µé¢ç©ºç™½æˆ–é”™è¯¯

**åŸå› **ï¼šå‰ç«¯æ„å»ºå¤±è´¥æˆ–æ–‡ä»¶ç¼ºå¤±

**è§£å†³**ï¼š
```bash
# æ£€æŸ¥å‰ç«¯æ–‡ä»¶
docker exec colorful-tibet-frontend ls -la /usr/share/nginx/html

# é‡æ–°æ„å»ºå‰ç«¯
docker compose build --no-cache frontend
docker compose up -d frontend
```

## ğŸ”§ å®Œæ•´é‡ç½®æ­¥éª¤

å¦‚æœé—®é¢˜æŒç»­ï¼Œå¯ä»¥å°è¯•å®Œå…¨é‡ç½®ï¼š

```bash
# 1. åœæ­¢æ‰€æœ‰æœåŠ¡
docker compose down

# 2. æ¸…ç†æ„å»ºç¼“å­˜
docker builder prune -a

# 3. é‡æ–°æ„å»º
docker compose build --no-cache

# 4. å¯åŠ¨æœåŠ¡
docker compose up -d

# 5. æŸ¥çœ‹æ—¥å¿—
docker compose logs -f
```

## ğŸ“ è¯Šæ–­å‘½ä»¤é›†åˆ

```bash
# å®Œæ•´è¯Šæ–­
echo "=== å®¹å™¨çŠ¶æ€ ==="
docker compose ps

echo "=== ç«¯å£å ç”¨ ==="
sudo netstat -tlnp | grep -E '80|8080'

echo "=== åç«¯æµ‹è¯• ==="
curl -I http://localhost:8080/api/spots

echo "=== å‰ç«¯æµ‹è¯• ==="
curl -I http://localhost

echo "=== åç«¯æ—¥å¿—ï¼ˆæœ€å 20 è¡Œï¼‰==="
docker compose logs backend | tail -20

echo "=== å‰ç«¯æ—¥å¿—ï¼ˆæœ€å 20 è¡Œï¼‰==="
docker compose logs frontend | tail -20
```

## ğŸ¯ å¿«é€Ÿä¿®å¤å‘½ä»¤

```bash
# ä¸€é”®è¯Šæ–­å’Œä¿®å¤
cd /opt/colorful-tibet

# åœæ­¢ç³»ç»Ÿ nginx
sudo systemctl stop nginx 2>/dev/null
sudo systemctl disable nginx 2>/dev/null

# é‡å¯ Docker æœåŠ¡
docker compose restart

# ç­‰å¾…æœåŠ¡å¯åŠ¨
sleep 10

# æ£€æŸ¥çŠ¶æ€
docker compose ps

# æµ‹è¯•æœåŠ¡
curl -I http://localhost:8080/api/spots
curl -I http://localhost
```

