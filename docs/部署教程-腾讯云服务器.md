# è¥¿è—æ—…æ¸¸ç½‘ç«™ - è…¾è®¯äº‘æœåŠ¡å™¨éƒ¨ç½²æ•™ç¨‹

æœ¬æ•™ç¨‹å°†è¯¦ç»†æŒ‡å¯¼æ‚¨å¦‚ä½•å°†æ•´ä¸ªé¡¹ç›®éƒ¨ç½²åˆ°è…¾è®¯äº‘æœåŠ¡å™¨ä¸Šã€‚

## âš ï¸ é‡è¦æç¤ºï¼šæƒé™è¯´æ˜

**å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯æ™®é€šç”¨æˆ·ï¼ˆå¦‚ `ubuntu`ï¼‰è€Œä¸æ˜¯ `root` ç”¨æˆ·ï¼Œè¯·åœ¨ä»¥ä¸‹å‘½ä»¤å‰åŠ  `sudo`ï¼š**

- `apt` / `apt-get` - è½¯ä»¶åŒ…å®‰è£…
- `systemctl` - æœåŠ¡ç®¡ç†
- `ufw` - é˜²ç«å¢™é…ç½®
- `nginx` - Nginx é…ç½®
- å…¶ä»–éœ€è¦ç®¡ç†å‘˜æƒé™çš„å‘½ä»¤

**ç¤ºä¾‹ï¼š**
```bash
# âŒ é”™è¯¯ï¼ˆæƒé™ä¸è¶³ï¼‰
apt install docker -y

# âœ… æ­£ç¡®
sudo apt install docker -y
```

**å¦‚æœä½¿ç”¨ `root` ç”¨æˆ·ï¼Œå¯ä»¥ä¸åŠ  `sudo`ã€‚**

æ›´å¤šæƒé™é—®é¢˜è¯·å‚è€ƒï¼š[å¸¸è§é—®é¢˜-æƒé™é—®é¢˜.md](./å¸¸è§é—®é¢˜-æƒé™é—®é¢˜.md)

---

## ğŸ“‹ ç›®å½•

1. [æœåŠ¡å™¨å‡†å¤‡](#1-æœåŠ¡å™¨å‡†å¤‡)
2. [ç¯å¢ƒå®‰è£…](#2-ç¯å¢ƒå®‰è£…)
3. [é¡¹ç›®éƒ¨ç½²æ–¹å¼é€‰æ‹©](#3-é¡¹ç›®éƒ¨ç½²æ–¹å¼é€‰æ‹©)
4. [æ–¹å¼ä¸€ï¼šDocker éƒ¨ç½²ï¼ˆæ¨èï¼‰](#æ–¹å¼ä¸€docker-éƒ¨ç½²æ¨è)
5. [æ–¹å¼äºŒï¼šä¼ ç»Ÿæ–¹å¼éƒ¨ç½²](#æ–¹å¼äºŒä¼ ç»Ÿæ–¹å¼éƒ¨ç½²)
6. [åŸŸåå’Œ HTTPS é…ç½®](#6-åŸŸåå’Œ-https-é…ç½®)
7. [é˜²ç«å¢™å’Œå®‰å…¨ç»„é…ç½®](#7-é˜²ç«å¢™å’Œå®‰å…¨ç»„é…ç½®)
8. [å¸¸è§é—®é¢˜æ’æŸ¥](#8-å¸¸è§é—®é¢˜æ’æŸ¥)

---

## 1. æœåŠ¡å™¨å‡†å¤‡

### 1.1 è´­ä¹°è…¾è®¯äº‘æœåŠ¡å™¨

1. ç™»å½• [è…¾è®¯äº‘æ§åˆ¶å°](https://console.cloud.tencent.com/)
2. è¿›å…¥ **äº‘æœåŠ¡å™¨ CVM** é¡µé¢
3. é€‰æ‹© **æ–°å»ºå®ä¾‹**
4. æ¨èé…ç½®ï¼š
   - **åœ°åŸŸ**ï¼šé€‰æ‹©ç¦»æ‚¨æœ€è¿‘çš„åœ°åŸŸ
   - **å®ä¾‹ç±»å‹**ï¼šæ ‡å‡†å‹ S5ï¼ˆ2æ ¸4GB èµ·æ­¥ï¼Œæ ¹æ®è®¿é—®é‡è°ƒæ•´ï¼‰
   - **é•œåƒ**ï¼šUbuntu 22.04 LTS æˆ– CentOS 7.9
   - **ç³»ç»Ÿç›˜**ï¼š50GB SSD äº‘ç¡¬ç›˜
   - **ç½‘ç»œ**ï¼šé»˜è®¤VPCï¼Œåˆ†é…å…¬ç½‘IP
   - **å®‰å…¨ç»„**ï¼šå¼€æ”¾ 22ï¼ˆSSHï¼‰ã€80ï¼ˆHTTPï¼‰ã€443ï¼ˆHTTPSï¼‰ã€8080ï¼ˆåç«¯APIï¼‰ç«¯å£

### 1.2 è¿æ¥æœåŠ¡å™¨

ä½¿ç”¨ SSH å·¥å…·è¿æ¥æœåŠ¡å™¨ï¼ˆWindows å¯ä½¿ç”¨ PuTTY æˆ– PowerShellï¼‰ï¼š

```bash
ssh root@æ‚¨çš„æœåŠ¡å™¨IP
```

é¦–æ¬¡è¿æ¥ä¼šæç¤ºè¾“å…¥å¯†ç ï¼ˆæˆ–ä½¿ç”¨å¯†é’¥ï¼‰ã€‚

---

## 2. ç¯å¢ƒå®‰è£…

### 2.1 æ›´æ–°ç³»ç»Ÿï¼ˆUbuntuï¼‰

```bash
sudo apt update && sudo apt upgrade -y
```

### 2.2 å®‰è£… Docker å’Œ Docker Composeï¼ˆæ¨èæ–¹å¼ï¼‰

```bash
# å®‰è£… Dockerï¼ˆå¦‚æœä½¿ç”¨é root ç”¨æˆ·ï¼Œéœ€è¦åŠ  sudoï¼‰
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# å¯åŠ¨ Docker æœåŠ¡
sudo systemctl start docker
sudo systemctl enable docker

# å°†å½“å‰ç”¨æˆ·æ·»åŠ åˆ° docker ç»„ï¼ˆå¯é€‰ï¼Œè¿™æ ·å°±ä¸éœ€è¦æ¯æ¬¡éƒ½ç”¨ sudoï¼‰
sudo usermod -aG docker $USER
# æ³¨æ„ï¼šæ·»åŠ ç”¨æˆ·åˆ° docker ç»„åï¼Œéœ€è¦é‡æ–°ç™»å½•æ‰èƒ½ç”Ÿæ•ˆ
# æˆ–è€…ä½¿ç”¨ï¼šnewgrp docker

# å®‰è£… Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/download/v2.20.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# éªŒè¯å®‰è£…
docker --version
docker-compose --version
```

**æ³¨æ„**ï¼š
- å¦‚æœä½¿ç”¨ `root` ç”¨æˆ·ï¼Œå¯ä»¥ä¸åŠ  `sudo`
- å¦‚æœä½¿ç”¨æ™®é€šç”¨æˆ·ï¼ˆå¦‚ `ubuntu`ï¼‰ï¼Œéœ€è¦åœ¨å‘½ä»¤å‰åŠ  `sudo` æˆ–è¾“å…¥å¯†ç 
- æ¨èå°†ç”¨æˆ·æ·»åŠ åˆ° `docker` ç»„ï¼Œè¿™æ ·åç»­ä½¿ç”¨ Docker å‘½ä»¤æ—¶å°±ä¸éœ€è¦ `sudo` äº†

### 2.3 å®‰è£… Java å’Œ Mavenï¼ˆä¼ ç»Ÿæ–¹å¼éœ€è¦ï¼‰

å¦‚æœé€‰æ‹©ä¼ ç»Ÿæ–¹å¼éƒ¨ç½²ï¼Œéœ€è¦å®‰è£…ï¼š

```bash
# å®‰è£… Java 17
sudo apt install openjdk-17-jdk -y

# å®‰è£… Maven
sudo apt install maven -y

# éªŒè¯å®‰è£…
java -version
mvn -version
```

### 2.4 å®‰è£… Node.js å’Œ npmï¼ˆä¼ ç»Ÿæ–¹å¼éœ€è¦ï¼‰

```bash
# ä½¿ç”¨ NodeSource å®‰è£… Node.js 20 LTSï¼ˆæ¨èï¼‰
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo bash -
sudo apt install -y nodejs

# æˆ–è€…å®‰è£… Node.js 22ï¼ˆæœ€æ–°ç‰ˆæœ¬ï¼‰
# curl -fsSL https://deb.nodesource.com/setup_22.x | sudo bash -
# sudo apt install -y nodejs

# éªŒè¯å®‰è£…
node -v
npm -v
```

**æ³¨æ„**ï¼š
- Node.js 18.x å·²ä¸å†è¢«ç§¯ææ”¯æŒï¼Œå»ºè®®ä½¿ç”¨ Node.js 20 LTS æˆ–æ›´æ–°ç‰ˆæœ¬
- å¦‚æœçœ‹åˆ° Node.js 18 çš„å¼ƒç”¨è­¦å‘Šï¼Œå¯ä»¥ç»§ç»­å®‰è£…ï¼Œä½†å»ºè®®å‡çº§åˆ°æ›´æ–°çš„ç‰ˆæœ¬
- Docker éƒ¨ç½²æ–¹å¼ä¼šè‡ªåŠ¨ä½¿ç”¨æœ€æ–°çš„ Node.js ç‰ˆæœ¬ï¼Œæ— éœ€æ‰‹åŠ¨å®‰è£…

### 2.5 å®‰è£… Nginxï¼ˆä¼ ç»Ÿæ–¹å¼éœ€è¦ï¼‰

```bash
sudo apt install nginx -y
sudo systemctl start nginx
sudo systemctl enable nginx
```

### 2.6 å®‰è£… MySQLï¼ˆå¯é€‰ï¼Œç”Ÿäº§ç¯å¢ƒæ¨èï¼‰

å¦‚æœä½¿ç”¨ MySQL æ›¿ä»£ H2 æ•°æ®åº“ï¼š

```bash
# å®‰è£… MySQL
sudo apt install mysql-server -y

# å¯åŠ¨ MySQL
sudo systemctl start mysql
sudo systemctl enable mysql

# å®‰å…¨é…ç½®
sudo mysql_secure_installation
```

**mysql_secure_installation é…ç½®è¯´æ˜**ï¼š

> âš ï¸ **æ³¨æ„**ï¼šMySQL 8.0 åœ¨ Ubuntu ä¸Šé»˜è®¤ä½¿ç”¨ `auth_socket` è®¤è¯ï¼Œå¯èƒ½ä¼šè·³è¿‡ root å¯†ç è®¾ç½®ã€‚è¿™æ˜¯æ­£å¸¸çš„ï¼Œå¯ä»¥ä½¿ç”¨ `sudo mysql -u root` ç›´æ¥ç™»å½•ã€‚

1. **å¯†ç éªŒè¯ç»„ä»¶**ï¼š`Would you like to setup VALIDATE PASSWORD component?`
   - **ç”Ÿäº§ç¯å¢ƒ**ï¼šè¾“å…¥ `Y`ï¼ˆæ¨èï¼Œå¼ºåˆ¶ä½¿ç”¨å¼ºå¯†ç ï¼‰
   - **å¼€å‘ç¯å¢ƒ**ï¼šè¾“å…¥ `N`ï¼ˆå¯ä»¥ä½¿ç”¨ç®€å•å¯†ç ï¼‰
   
2. **å¯†ç éªŒè¯çº§åˆ«**ï¼ˆå¦‚æœé€‰æ‹©äº† Yï¼‰ï¼š
   - `0` = LOWï¼ˆè‡³å°‘ 8 ä¸ªå­—ç¬¦ï¼‰
   - `1` = MEDIUMï¼ˆæ¨èï¼Œéœ€è¦æ•°å­—ã€å¤§å°å†™å­—æ¯ã€ç‰¹æ®Šå­—ç¬¦ï¼‰
   - `2` = STRONGï¼ˆæœ€ä¸¥æ ¼ï¼‰

3. **è®¾ç½® root å¯†ç **ï¼š
   - å¦‚æœçœ‹åˆ° "Skipping password set" æ¶ˆæ¯ï¼Œè¯´æ˜ä½¿ç”¨ auth_socket è®¤è¯ï¼ˆæ­£å¸¸ï¼‰
   - å¦‚æœéœ€è¦å¯†ç è®¤è¯ï¼Œå¯ä»¥åœ¨é…ç½®å®Œæˆåæ‰‹åŠ¨è®¾ç½®ï¼ˆè§ä¸‹æ–¹ï¼‰

4. **åˆ é™¤åŒ¿åç”¨æˆ·**ï¼šè¾“å…¥ `Y`ï¼ˆæ¨èï¼‰âœ…

5. **ç¦æ­¢ root è¿œç¨‹ç™»å½•**ï¼šè¾“å…¥ `Y`ï¼ˆæ¨èï¼Œæé«˜å®‰å…¨æ€§ï¼‰âœ…

6. **åˆ é™¤æµ‹è¯•æ•°æ®åº“**ï¼šè¾“å…¥ `Y`ï¼ˆæ¨èï¼‰âœ…

7. **é‡æ–°åŠ è½½æƒé™è¡¨**ï¼šè¾“å…¥ `Y`ï¼ˆä½¿æ›´æ”¹ç”Ÿæ•ˆï¼‰

**è¯¦ç»†é…ç½®è¯´æ˜è¯·å‚è€ƒ**ï¼š[MySQLé…ç½®æŒ‡å—.md](./MySQLé…ç½®æŒ‡å—.md)

åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·ï¼š

```bash
# ç™»å½• MySQLï¼ˆMySQL 8.0 é»˜è®¤ä½¿ç”¨ auth_socketï¼Œæ— éœ€å¯†ç ï¼‰
sudo mysql -u root

# å¦‚æœéœ€è¦ä½¿ç”¨å¯†ç ç™»å½•ï¼Œå…ˆè®¾ç½®å¯†ç ï¼š
# ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'your_password';
# FLUSH PRIVILEGES;
# ç„¶åä½¿ç”¨ï¼šmysql -u root -p
```

åœ¨ MySQL ä¸­æ‰§è¡Œï¼š

```sql
CREATE DATABASE tibet_tourism CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'tibet_user'@'localhost' IDENTIFIED BY 'your_strong_password';
GRANT ALL PRIVILEGES ON tibet_tourism.* TO 'tibet_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

---

## 3. é¡¹ç›®éƒ¨ç½²æ–¹å¼é€‰æ‹©

æœ¬é¡¹ç›®æ”¯æŒä¸¤ç§éƒ¨ç½²æ–¹å¼ï¼š

- **æ–¹å¼ä¸€ï¼šDocker éƒ¨ç½²ï¼ˆæ¨èï¼‰** - ç®€å•å¿«é€Ÿï¼Œç¯å¢ƒéš”ç¦»
- **æ–¹å¼äºŒï¼šä¼ ç»Ÿæ–¹å¼éƒ¨ç½²** - ç›´æ¥è¿è¡Œï¼Œä¾¿äºè°ƒè¯•

---

## æ–¹å¼ä¸€ï¼šDocker éƒ¨ç½²ï¼ˆæ¨èï¼‰

### æ­¥éª¤ 1ï¼šä¸Šä¼ é¡¹ç›®ä»£ç 

#### æ–¹æ³• Aï¼šä½¿ç”¨ Gitï¼ˆæ¨èï¼‰

```bash
# å®‰è£… Git
sudo apt install git -y

# å…‹éš†é¡¹ç›®
cd /opt

# å¦‚æœç›®å½•å·²å­˜åœ¨ï¼Œå¯ä»¥é€‰æ‹©ï¼š
# æ–¹æ¡ˆ 1ï¼šåˆ é™¤æ—§ç›®å½•ï¼ˆå¦‚æœä¸éœ€è¦ä¿ç•™ï¼‰
# sudo rm -rf colorful-tibet

# æ–¹æ¡ˆ 2ï¼šè¿›å…¥ç°æœ‰ç›®å½•å¹¶æ›´æ–°ä»£ç ï¼ˆå¦‚æœæ˜¯ Git ä»“åº“ï¼‰
# cd colorful-tibet
# git pull

# æ–¹æ¡ˆ 3ï¼šå…‹éš†åˆ°æ–°ç›®å½•
# git clone https://github.com/suli9710/colorful-tibet.git colorful-tibet-new

# å¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œç›´æ¥å…‹éš†ï¼ˆ/opt ç›®å½•éœ€è¦ sudoï¼‰
# å…¬å¼€ä»“åº“å¯ä»¥ç›´æ¥å…‹éš†ï¼Œæ— éœ€è®¤è¯
sudo git clone https://github.com/suli9710/colorful-tibet.git
sudo chown -R $USER:$USER colorful-tibet  # ä¿®æ”¹æ‰€æœ‰è€…ï¼Œæ–¹ä¾¿åç»­æ“ä½œ
cd colorful-tibet
```

**å¦‚æœé‡åˆ° "destination path already exists" é”™è¯¯**ï¼š
- å¦‚æœç›®å½•å·²å­˜åœ¨ä¸”éœ€è¦æ›´æ–°ä»£ç ï¼š`cd colorful-tibet && git pull`
- å¦‚æœç›®å½•å·²å­˜åœ¨ä½†éœ€è¦é‡æ–°å…‹éš†ï¼šå…ˆåˆ é™¤ `sudo rm -rf colorful-tibet`ï¼Œç„¶åé‡æ–°å…‹éš†

#### æ–¹æ³• Bï¼šä½¿ç”¨ SCP ä¸Šä¼ 

åœ¨æœ¬åœ°ç”µè„‘æ‰§è¡Œï¼š

```bash
# Windows PowerShell
scp -r C:\Users\Suli\Desktop\colorful-tibet root@æ‚¨çš„æœåŠ¡å™¨IP:/opt/
```

### æ­¥éª¤ 2ï¼šé…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼ˆåœ¨é¡¹ç›®æ ¹ç›®å½•ï¼‰ï¼š

```bash
cd /opt/colorful-tibet
nano .env
```

æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼ˆæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ï¼‰ï¼š

```env
# è±†åŒ… API é…ç½®
DOUBAO_API_KEY=your-doubao-api-key
DOUBAO_API_URL=https://ark.cn-beijing.volces.com/api/v3/chat/completions
DOUBAO_MODEL=your-model-name

# JWT å¯†é’¥ï¼ˆç”Ÿäº§ç¯å¢ƒè¯·ä½¿ç”¨å¼ºéšæœºå­—ç¬¦ä¸²ï¼‰
JWT_SECRET=your-very-long-random-secret-key-at-least-32-characters

# ç®¡ç†å‘˜åŠ å¯†å¯†é’¥
ADMIN_ENCRYPTION_KEY=your-very-long-random-secret-key-at-least-32-characters
```

### æ­¥éª¤ 3ï¼šä¿®æ”¹ docker-compose.yml

ç¼–è¾‘ `docker-compose.yml`ï¼Œä¿®æ”¹å‰ç«¯ API åœ°å€ï¼š

```bash
nano docker-compose.yml
```

å°†ç¬¬ 36 è¡Œä¿®æ”¹ä¸ºï¼š

```yaml
environment:
  - VITE_API_BASE_URL=http://æ‚¨çš„æœåŠ¡å™¨IP:8080/api
```

æˆ–è€…å¦‚æœä½¿ç”¨åŸŸåï¼š

```yaml
environment:
  - VITE_API_BASE_URL=https://your-domain.com/api
```

### æ­¥éª¤ 4ï¼šæ„å»ºå’Œå¯åŠ¨

```bash
# æ„å»ºé•œåƒ
docker-compose build

# å¯åŠ¨æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
docker-compose ps
```

### æ­¥éª¤ 5ï¼šéªŒè¯éƒ¨ç½²

- **å‰ç«¯**ï¼šè®¿é—® `http://æ‚¨çš„æœåŠ¡å™¨IP`
- **åç«¯ API**ï¼šè®¿é—® `http://æ‚¨çš„æœåŠ¡å™¨IP:8080/api/spots`

### æ­¥éª¤ 6ï¼šå¸¸ç”¨å‘½ä»¤

```bash
# åœæ­¢æœåŠ¡
docker-compose down

# é‡å¯æœåŠ¡
docker-compose restart

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs backend
docker-compose logs frontend

# æ›´æ–°ä»£ç åé‡æ–°éƒ¨ç½²
git pull
docker-compose build
docker-compose up -d
```

---

## æ–¹å¼äºŒï¼šä¼ ç»Ÿæ–¹å¼éƒ¨ç½²

### æ­¥éª¤ 1ï¼šä¸Šä¼ é¡¹ç›®ä»£ç 

å‚è€ƒ Docker éƒ¨ç½²çš„æ­¥éª¤ 1ã€‚

### æ­¥éª¤ 2ï¼šéƒ¨ç½²åç«¯

```bash
cd /opt/colorful-tibet/backend

# ç¼–è¯‘é¡¹ç›®
mvn clean package -DskipTests

# åˆ›å»ºè¿è¡Œç›®å½•
mkdir -p /opt/colorful-tibet/run
mkdir -p /opt/colorful-tibet/logs
mkdir -p /opt/colorful-tibet/data

# å¤åˆ¶ JAR æ–‡ä»¶
cp target/tourism-0.0.1-SNAPSHOT.jar /opt/colorful-tibet/run/

# åˆ›å»ºå¯åŠ¨è„šæœ¬
nano /opt/colorful-tibet/run/start-backend.sh
```

å¯åŠ¨è„šæœ¬å†…å®¹ï¼š

```bash
#!/bin/bash
cd /opt/colorful-tibet/run
java -jar tourism-0.0.1-SNAPSHOT.jar \
  --spring.profiles.active=prod \
  --spring.datasource.url=jdbc:mysql://localhost:3306/tibet_tourism?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai \
  --spring.datasource.username=tibet_user \
  --spring.datasource.password=your_strong_password \
  --jwt.secret=your-jwt-secret \
  --doubao.api.key=your-doubao-api-key \
  --doubao.api.url=https://ark.cn-beijing.volces.com/api/v3/chat/completions \
  --doubao.api.model=your-model-name \
  > /opt/colorful-tibet/logs/backend.log 2>&1 &
echo $! > /opt/colorful-tibet/run/backend.pid
```

```bash
chmod +x /opt/colorful-tibet/run/start-backend.sh
```

### æ­¥éª¤ 3ï¼šåˆ›å»º systemd æœåŠ¡ï¼ˆå¯é€‰ï¼Œæ¨èï¼‰

```bash
nano /etc/systemd/system/tibet-backend.service
```

å†…å®¹ï¼š

```ini
[Unit]
Description=Tibet Tourism Backend Service
After=network.target mysql.service

[Service]
Type=simple
User=root
WorkingDirectory=/opt/colorful-tibet/run
ExecStart=/usr/bin/java -jar /opt/colorful-tibet/run/tourism-0.0.1-SNAPSHOT.jar --spring.profiles.active=prod
Restart=always
RestartSec=10
StandardOutput=append:/opt/colorful-tibet/logs/backend.log
StandardError=append:/opt/colorful-tibet/logs/backend.log

[Install]
WantedBy=multi-user.target
```

å¯åŠ¨æœåŠ¡ï¼š

```bash
sudo systemctl daemon-reload
sudo systemctl start tibet-backend
sudo systemctl enable tibet-backend
sudo systemctl status tibet-backend
```

### æ­¥éª¤ 4ï¼šéƒ¨ç½²å‰ç«¯

```bash
cd /opt/colorful-tibet/frontend

# å®‰è£…ä¾èµ–
npm install

# æ„å»ºé¡¹ç›®ï¼ˆè®¾ç½® API åœ°å€ï¼‰
VITE_API_BASE_URL=http://æ‚¨çš„æœåŠ¡å™¨IP:8080/api npm run build

# å¤åˆ¶æ„å»ºæ–‡ä»¶åˆ° Nginx
cp -r dist/* /var/www/html/

# æˆ–è€…ä½¿ç”¨è‡ªå®šä¹‰ç›®å½•
mkdir -p /var/www/colorful-tibet
cp -r dist/* /var/www/colorful-tibet/
```

### æ­¥éª¤ 5ï¼šé…ç½® Nginx

```bash
nano /etc/nginx/sites-available/colorful-tibet
```

å†…å®¹ï¼š

```nginx
server {
    listen 80;
    server_name æ‚¨çš„åŸŸåæˆ–IP;
    root /var/www/colorful-tibet;
    index index.html;

    # å‰ç«¯è·¯ç”±æ”¯æŒ
    location / {
        try_files $uri $uri/ /index.html;
    }

    # API ä»£ç†
    location /api {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # å¢åŠ è¶…æ—¶æ—¶é—´ï¼ˆé€‚åº” AI ç”Ÿæˆï¼‰
        proxy_connect_timeout 120s;
        proxy_send_timeout 120s;
        proxy_read_timeout 120s;
    }

    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # Gzip å‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript application/x-javascript application/xml+rss application/json application/javascript;
}
```

å¯ç”¨é…ç½®ï¼š

```bash
sudo ln -s /etc/nginx/sites-available/colorful-tibet /etc/nginx/sites-enabled/
sudo nginx -t  # æµ‹è¯•é…ç½®
sudo systemctl reload nginx
```

### æ­¥éª¤ 6ï¼šéªŒè¯éƒ¨ç½²

- **å‰ç«¯**ï¼šè®¿é—® `http://æ‚¨çš„æœåŠ¡å™¨IP`
- **åç«¯ API**ï¼šè®¿é—® `http://æ‚¨çš„æœåŠ¡å™¨IP:8080/api/spots`

---

## 6. åŸŸåå’Œ HTTPS é…ç½®

### 6.1 é…ç½®åŸŸåè§£æ

åœ¨åŸŸåæœåŠ¡å•†å¤„æ·»åŠ  A è®°å½•ï¼ŒæŒ‡å‘æ‚¨çš„æœåŠ¡å™¨ IPã€‚

### 6.2 å®‰è£… Certbotï¼ˆLet's Encryptï¼‰

```bash
sudo apt install certbot python3-certbot-nginx -y
```

### 6.3 ç”³è¯· SSL è¯ä¹¦

```bash
certbot --nginx -d your-domain.com -d www.your-domain.com
```

æŒ‰ç…§æç¤ºå®Œæˆé…ç½®ï¼ŒCertbot ä¼šè‡ªåŠ¨é…ç½® Nginxã€‚

### 6.4 è‡ªåŠ¨ç»­æœŸ

```bash
certbot renew --dry-run
```

è¯ä¹¦ä¼šè‡ªåŠ¨ç»­æœŸï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œã€‚

---

## 7. é˜²ç«å¢™å’Œå®‰å…¨ç»„é…ç½®

### 7.1 æœåŠ¡å™¨é˜²ç«å¢™ï¼ˆUbuntu UFWï¼‰

```bash
# å…è®¸ SSH
sudo ufw allow 22/tcp

# å…è®¸ HTTP å’Œ HTTPS
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# å…è®¸åç«¯ APIï¼ˆå¦‚æœç›´æ¥è®¿é—®ï¼‰
sudo ufw allow 8080/tcp

# å¯ç”¨é˜²ç«å¢™
sudo ufw enable
sudo ufw status
```

### 7.2 è…¾è®¯äº‘å®‰å…¨ç»„

åœ¨è…¾è®¯äº‘æ§åˆ¶å°é…ç½®å®‰å…¨ç»„è§„åˆ™ï¼š

- **å…¥ç«™è§„åˆ™**ï¼š
  - 22/tcpï¼ˆSSHï¼‰
  - 80/tcpï¼ˆHTTPï¼‰
  - 443/tcpï¼ˆHTTPSï¼‰
  - 8080/tcpï¼ˆåç«¯ APIï¼Œå¯é€‰ï¼Œå»ºè®®ä»…å†…ç½‘è®¿é—®ï¼‰

---

## 8. å¸¸è§é—®é¢˜æ’æŸ¥

> ğŸ’¡ **æ›´å¤šå¸¸è§é—®é¢˜è¯·å‚è€ƒ**ï¼š
> - [å¸¸è§é—®é¢˜-æƒé™é—®é¢˜.md](./å¸¸è§é—®é¢˜-æƒé™é—®é¢˜.md)
> - [å¸¸è§é—®é¢˜-Node.jsç‰ˆæœ¬.md](./å¸¸è§é—®é¢˜-Node.jsç‰ˆæœ¬.md)
> - [å¸¸è§é—®é¢˜-Gitå…‹éš†.md](./å¸¸è§é—®é¢˜-Gitå…‹éš†.md)

### 8.1 åç«¯æ— æ³•å¯åŠ¨

```bash
# æŸ¥çœ‹æ—¥å¿—
docker-compose logs backend
# æˆ–
tail -f /opt/colorful-tibet/logs/backend.log

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep 8080

# æ£€æŸ¥ Java è¿›ç¨‹
ps aux | grep java
```

### 8.2 å‰ç«¯æ— æ³•è®¿é—®åç«¯

1. æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œï¼š`curl http://localhost:8080/api/spots`
2. æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
3. æ£€æŸ¥ Nginx é…ç½®ä¸­çš„ proxy_pass åœ°å€
4. æ£€æŸ¥å‰ç«¯æ„å»ºæ—¶çš„ `VITE_API_BASE_URL` ç¯å¢ƒå˜é‡

### 8.3 æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥ MySQL æœåŠ¡
sudo systemctl status mysql

# æµ‹è¯•è¿æ¥
mysql -u tibet_user -p tibet_tourism
# å¦‚æœæç¤ºæƒé™ä¸è¶³ï¼Œä½¿ç”¨ï¼šsudo mysql -u tibet_user -p tibet_tourism

# æ£€æŸ¥æ•°æ®åº“é…ç½®
cat backend/src/main/resources/application-prod.yml
```

### 8.4 Docker å®¹å™¨æ— æ³•å¯åŠ¨

```bash
# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker-compose logs

# æ£€æŸ¥é•œåƒæ„å»º
docker-compose build --no-cache

# æ£€æŸ¥ç«¯å£å†²çª
docker ps
netstat -tlnp | grep 8080
```

### 8.5 å†…å­˜ä¸è¶³

```bash
# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
free -h

# æŸ¥çœ‹ Docker èµ„æºä½¿ç”¨
docker stats

# å¦‚æœå†…å­˜ä¸è¶³ï¼Œå¯ä»¥ï¼š
# 1. å‡çº§æœåŠ¡å™¨é…ç½®
# 2. ä¼˜åŒ– JVM å‚æ•°ï¼ˆå‡å°‘å †å†…å­˜ï¼‰
# 3. ä½¿ç”¨ swap ç©ºé—´
```

### 8.6 æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **æ•°æ®åº“ä¼˜åŒ–**ï¼š
   - ä½¿ç”¨ MySQL æ›¿ä»£ H2ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
   - é…ç½®æ•°æ®åº“è¿æ¥æ± 
   - æ·»åŠ å¿…è¦çš„ç´¢å¼•

2. **åº”ç”¨ä¼˜åŒ–**ï¼š
   - è°ƒæ•´ JVM å‚æ•°
   - å¯ç”¨ Gzip å‹ç¼©
   - é…ç½®é™æ€èµ„æºç¼“å­˜

3. **æœåŠ¡å™¨ä¼˜åŒ–**ï¼š
   - ä½¿ç”¨ SSD ç¡¬ç›˜
   - å¢åŠ æœåŠ¡å™¨å†…å­˜
   - é…ç½® CDNï¼ˆå¯é€‰ï¼‰

---

## 9. ç»´æŠ¤å’Œæ›´æ–°

### 9.1 æ›´æ–°ä»£ç 

```bash
# Docker æ–¹å¼
cd /opt/colorful-tibet
git pull
docker-compose build
docker-compose up -d

# ä¼ ç»Ÿæ–¹å¼
cd /opt/colorful-tibet
git pull
cd backend && mvn clean package -DskipTests
sudo systemctl restart tibet-backend
cd ../frontend && npm run build
sudo cp -r dist/* /var/www/colorful-tibet/
```

### 9.2 å¤‡ä»½æ•°æ®

```bash
# å¤‡ä»½æ•°æ®åº“ï¼ˆMySQLï¼‰
mysqldump -u tibet_user -p tibet_tourism > backup_$(date +%Y%m%d).sql

# å¤‡ä»½ H2 æ•°æ®åº“æ–‡ä»¶
cp /opt/colorful-tibet/data/tibet_tourism.mv.db /opt/backup/
```

### 9.3 ç›‘æ§æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹åç«¯æ—¥å¿—
tail -f /opt/colorful-tibet/logs/backend.log

# æŸ¥çœ‹ Nginx è®¿é—®æ—¥å¿—
tail -f /var/log/nginx/access.log

# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
htop
```

---

## 10. å¿«é€Ÿéƒ¨ç½²è„šæœ¬

é¡¹ç›®æ ¹ç›®å½•å·²åŒ…å« `deploy.sh` è„šæœ¬ï¼Œå¯ç”¨äºå¿«é€Ÿéƒ¨ç½²ï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰ï¼š

```bash
chmod +x deploy.sh
./deploy.sh all  # éƒ¨ç½²å‰åç«¯
./deploy.sh backend  # ä»…éƒ¨ç½²åç«¯
./deploy.sh frontend  # ä»…éƒ¨ç½²å‰ç«¯
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æ—¥å¿—æ–‡ä»¶
2. æœåŠ¡å™¨èµ„æºä½¿ç”¨æƒ…å†µ
3. ç½‘ç»œè¿æ¥
4. é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®

---

**ç¥æ‚¨éƒ¨ç½²é¡ºåˆ©ï¼** ğŸ‰

