# å¿«é€Ÿéƒ¨ç½²æŒ‡å—

æœ¬æ–‡æ¡£æä¾›æœ€å¿«é€Ÿçš„éƒ¨ç½²æ–¹æ³•ï¼Œé€‚åˆç†Ÿæ‚‰ Linux çš„ç”¨æˆ·ã€‚

## ğŸš€ ä¸€é”®éƒ¨ç½²ï¼ˆæ¨èï¼‰

### âš ï¸ æƒé™è¯´æ˜

**å¦‚æœä½¿ç”¨æ™®é€šç”¨æˆ·ï¼ˆå¦‚ `ubuntu`ï¼‰ï¼Œéƒ¨ç½²è„šæœ¬ä¼šè‡ªåŠ¨å¤„ç†æƒé™é—®é¢˜ã€‚å¦‚æœæ‰‹åŠ¨æ‰§è¡Œå‘½ä»¤ï¼Œè¯·åœ¨éœ€è¦ç®¡ç†å‘˜æƒé™çš„å‘½ä»¤å‰åŠ  `sudo`ã€‚**

### å‰ææ¡ä»¶

1. å·²è´­ä¹°è…¾è®¯äº‘æœåŠ¡å™¨ï¼ˆUbuntu 22.04 æˆ– CentOS 7.9ï¼‰
2. å·²é€šè¿‡ SSH è¿æ¥åˆ°æœåŠ¡å™¨
3. å·²è·å–é¡¹ç›®ä»£ç ï¼ˆGit ä»“åº“æˆ–å·²ä¸Šä¼ ä»£ç ï¼‰

### æ­¥éª¤ 1ï¼šä¸Šä¼ é¡¹ç›®ä»£ç 

**æ–¹æ³• Aï¼šä½¿ç”¨ Gitï¼ˆæ¨èï¼‰**

```bash
cd /opt
# å…¬å¼€ä»“åº“å¯ä»¥ç›´æ¥å…‹éš†ï¼Œæ— éœ€è®¤è¯
sudo git clone https://github.com/suli9710/colorful-tibet.git
sudo chown -R $USER:$USER colorful-tibet  # ä¿®æ”¹æ‰€æœ‰è€…ï¼Œæ–¹ä¾¿åç»­æ“ä½œ
cd colorful-tibet
```

**æ–¹æ³• Bï¼šä½¿ç”¨ SCP ä¸Šä¼ **

åœ¨æœ¬åœ°ç”µè„‘æ‰§è¡Œï¼š

```bash
# Windows PowerShell
scp -r C:\Users\Suli\Desktop\colorful-tibet root@æ‚¨çš„æœåŠ¡å™¨IP:/opt/
```

### æ­¥éª¤ 2ï¼šè¿è¡Œéƒ¨ç½²è„šæœ¬

```bash
cd /opt/colorful-tibet
chmod +x deploy-tencent-cloud.sh
./deploy-tencent-cloud.sh
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- âœ… å®‰è£… Docker å’Œ Docker Compose
- âœ… é…ç½®é˜²ç«å¢™è§„åˆ™
- âœ… åˆ›å»ºå¿…è¦çš„ç›®å½•
- âœ… ç”Ÿæˆç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶
- âœ… æ›´æ–° docker-compose.yml
- âœ… æ„å»ºå¹¶å¯åŠ¨æœåŠ¡

### æ­¥éª¤ 3ï¼šé…ç½®ç¯å¢ƒå˜é‡

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œå¡«å…¥æ­£ç¡®çš„é…ç½®ï¼š

```bash
nano /opt/colorful-tibet/.env
```

**å¿…é¡»ä¿®æ”¹çš„é…ç½®ï¼š**
- `DOUBAO_API_KEY` - æ‚¨çš„è±†åŒ… API Key
- `DOUBAO_API_URL` - è±†åŒ… API åœ°å€
- `DOUBAO_MODEL` - è±†åŒ…æ¨¡å‹åç§°

**å¯é€‰ä¿®æ”¹çš„é…ç½®ï¼š**
- `JWT_SECRET` - JWT å¯†é’¥ï¼ˆè„šæœ¬å·²è‡ªåŠ¨ç”Ÿæˆï¼‰
- `ADMIN_ENCRYPTION_KEY` - ç®¡ç†å‘˜åŠ å¯†å¯†é’¥ï¼ˆè„šæœ¬å·²è‡ªåŠ¨ç”Ÿæˆï¼‰

### æ­¥éª¤ 4ï¼šé‡å¯æœåŠ¡ï¼ˆå¦‚æœä¿®æ”¹äº†é…ç½®ï¼‰

```bash
cd /opt/colorful-tibet
docker-compose restart
```

### æ­¥éª¤ 5ï¼šè®¿é—®ç½‘ç«™

- **å‰ç«¯**: http://æ‚¨çš„æœåŠ¡å™¨IP
- **åç«¯ API**: http://æ‚¨çš„æœåŠ¡å™¨IP:8080/api/spots

---

## ğŸ“ æ‰‹åŠ¨éƒ¨ç½²æ­¥éª¤

å¦‚æœè‡ªåŠ¨è„šæœ¬æ— æ³•ä½¿ç”¨ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ‰‹åŠ¨éƒ¨ç½²ï¼š

### 1. å®‰è£… Docker

```bash
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo systemctl start docker
sudo systemctl enable docker

# å°†ç”¨æˆ·æ·»åŠ åˆ° docker ç»„ï¼ˆå¯é€‰ï¼Œè¿™æ ·å°±ä¸éœ€è¦ sudoï¼‰
sudo usermod -aG docker $USER
newgrp docker  # æˆ–é‡æ–°ç™»å½•
```

### 2. å®‰è£… Docker Compose

```bash
sudo curl -L "https://github.com/docker/compose/releases/download/v2.20.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
```

### 3. é…ç½®ç¯å¢ƒå˜é‡

```bash
cd /opt/colorful-tibet
cp .env.example .env
nano .env  # ç¼–è¾‘é…ç½®æ–‡ä»¶
```

### 4. ä¿®æ”¹ docker-compose.yml

ç¼–è¾‘ `docker-compose.yml`ï¼Œå°†ç¬¬ 36 è¡Œçš„ `VITE_API_BASE_URL` æ”¹ä¸ºæ‚¨çš„æœåŠ¡å™¨ IPï¼š

```yaml
environment:
  - VITE_API_BASE_URL=http://æ‚¨çš„æœåŠ¡å™¨IP:8080/api
```

### 5. å¯åŠ¨æœåŠ¡

```bash
docker-compose build
docker-compose up -d
```

### 6. æŸ¥çœ‹æ—¥å¿—

```bash
docker-compose logs -f
```

---

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
docker-compose logs backend
docker-compose logs frontend

# é‡å¯æœåŠ¡
docker-compose restart

# åœæ­¢æœåŠ¡
docker-compose down

# æ›´æ–°ä»£ç åé‡æ–°éƒ¨ç½²
git pull
docker-compose build
docker-compose up -d
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å®‰å…¨ç»„é…ç½®**ï¼šç¡®ä¿è…¾è®¯äº‘å®‰å…¨ç»„å·²å¼€æ”¾ä»¥ä¸‹ç«¯å£ï¼š
   - 22 (SSH)
   - 80 (HTTP)
   - 443 (HTTPS)
   - 8080 (åç«¯ APIï¼Œå¯é€‰)

2. **ç¯å¢ƒå˜é‡**ï¼šç”Ÿäº§ç¯å¢ƒåŠ¡å¿…ä¿®æ”¹ `.env` æ–‡ä»¶ä¸­çš„å¯†é’¥ï¼Œä¸è¦ä½¿ç”¨é»˜è®¤å€¼ã€‚

3. **åŸŸåé…ç½®**ï¼šå¦‚éœ€ä½¿ç”¨åŸŸåï¼Œè¯·ï¼š
   - é…ç½®åŸŸåè§£æï¼ˆA è®°å½•æŒ‡å‘æœåŠ¡å™¨ IPï¼‰
   - å®‰è£… SSL è¯ä¹¦ï¼ˆä½¿ç”¨ Let's Encryptï¼‰
   - æ›´æ–° `VITE_API_BASE_URL` ä¸ºåŸŸååœ°å€

4. **æ•°æ®åº“**ï¼šé»˜è®¤ä½¿ç”¨ H2 å†…å­˜æ•°æ®åº“ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ MySQLã€‚

---

## ğŸ› é—®é¢˜æ’æŸ¥

### æœåŠ¡æ— æ³•å¯åŠ¨

```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker-compose logs

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep 8080

# æ£€æŸ¥ Docker çŠ¶æ€
sudo systemctl status docker
```

### å‰ç«¯æ— æ³•è®¿é—®åç«¯

1. æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œï¼š`curl http://localhost:8080/api/spots`
2. æ£€æŸ¥ `VITE_API_BASE_URL` é…ç½®æ˜¯å¦æ­£ç¡®
3. æ£€æŸ¥é˜²ç«å¢™è§„åˆ™

### å†…å­˜ä¸è¶³

```bash
# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
free -h

# æŸ¥çœ‹ Docker èµ„æºä½¿ç”¨
docker stats
```

---

## ğŸ“š æ›´å¤šä¿¡æ¯

è¯¦ç»†éƒ¨ç½²æ•™ç¨‹è¯·å‚è€ƒï¼š[éƒ¨ç½²æ•™ç¨‹-è…¾è®¯äº‘æœåŠ¡å™¨.md](./éƒ¨ç½²æ•™ç¨‹-è…¾è®¯äº‘æœåŠ¡å™¨.md)

