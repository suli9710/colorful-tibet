# éƒ¨ç½²åç»­æ­¥éª¤æŒ‡å—

## âœ… å½“å‰çŠ¶æ€

æ‚¨å·²ç»æˆåŠŸï¼š
- âœ… å…‹éš†äº†é¡¹ç›®åˆ° `/opt/colorful-tibet`
- âœ… ä¿®æ”¹äº†ç›®å½•æ‰€æœ‰è€…
- âœ… è¿›å…¥äº†é¡¹ç›®ç›®å½•

## ğŸ“‹ æ¥ä¸‹æ¥çš„æ­¥éª¤

### æ–¹å¼ä¸€ï¼šä½¿ç”¨ Docker éƒ¨ç½²ï¼ˆæ¨èï¼Œæœ€ç®€å•ï¼‰

#### æ­¥éª¤ 1ï¼šæ£€æŸ¥ Docker æ˜¯å¦å·²å®‰è£…

```bash
# æ£€æŸ¥ Docker
docker --version
docker-compose --version
```

å¦‚æœæœªå®‰è£…ï¼Œæ‰§è¡Œï¼š
```bash
# å®‰è£… Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo systemctl start docker
sudo systemctl enable docker

# å°†ç”¨æˆ·æ·»åŠ åˆ° docker ç»„
sudo usermod -aG docker $USER
newgrp docker  # æˆ–é‡æ–°ç™»å½•

# å®‰è£… Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/download/v2.20.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
```

#### æ­¥éª¤ 2ï¼šé…ç½®ç¯å¢ƒå˜é‡

```bash
# åˆ›å»º .env æ–‡ä»¶
nano .env
```

æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼ˆæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ï¼‰ï¼š

```env
# è±†åŒ… API é…ç½®ï¼ˆå¿…éœ€ï¼‰
DOUBAO_API_KEY=your-doubao-api-key
DOUBAO_API_URL=https://ark.cn-beijing.volces.com/api/v3/chat/completions
DOUBAO_MODEL=your-model-name

# JWT å¯†é’¥ï¼ˆç”Ÿæˆæ–¹æ³•ï¼šopenssl rand -hex 32ï¼‰
JWT_SECRET=your-very-long-random-secret-key-at-least-32-characters

# ç®¡ç†å‘˜åŠ å¯†å¯†é’¥ï¼ˆç”Ÿæˆæ–¹æ³•ï¼šopenssl rand -hex 32ï¼‰
ADMIN_ENCRYPTION_KEY=your-very-long-random-secret-key-at-least-32-characters
```

**ä¿å­˜æ–‡ä»¶**ï¼šæŒ‰ `Ctrl + O`ï¼Œç„¶å `Enter`ï¼Œæœ€å `Ctrl + X` é€€å‡ºã€‚

#### æ­¥éª¤ 3ï¼šä¿®æ”¹ docker-compose.ymlï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦ä¿®æ”¹å‰ç«¯ API åœ°å€ï¼Œç¼–è¾‘ `docker-compose.yml`ï¼š

```bash
nano docker-compose.yml
```

æ‰¾åˆ°ç¬¬ 36 è¡Œå·¦å³ï¼Œä¿®æ”¹ `VITE_API_BASE_URL`ï¼š
```yaml
environment:
  - VITE_API_BASE_URL=http://æ‚¨çš„æœåŠ¡å™¨IP:8080/api
```

æˆ–è€…å¦‚æœä½¿ç”¨åŸŸåï¼š
```yaml
environment:
  - VITE_API_BASE_URL=https://your-domain.com/api
```

#### æ­¥éª¤ 4ï¼šæ„å»ºå’Œå¯åŠ¨æœåŠ¡

```bash
# æ„å»º Docker é•œåƒ
docker-compose build

# å¯åŠ¨æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

#### æ­¥éª¤ 5ï¼šéªŒè¯éƒ¨ç½²

- **å‰ç«¯**ï¼šè®¿é—® `http://æ‚¨çš„æœåŠ¡å™¨IP`
- **åç«¯ API**ï¼šè®¿é—® `http://æ‚¨çš„æœåŠ¡å™¨IP:8080/api/spots`

---

### æ–¹å¼äºŒï¼šä½¿ç”¨ä¸€é”®éƒ¨ç½²è„šæœ¬ï¼ˆæœ€ç®€å•ï¼‰

å¦‚æœé¡¹ç›®ä¸­æœ‰ `deploy-tencent-cloud.sh` è„šæœ¬ï¼š

```bash
# ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x deploy-tencent-cloud.sh

# è¿è¡Œè„šæœ¬
./deploy-tencent-cloud.sh
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- å®‰è£… Docker å’Œ Docker Compose
- é…ç½®ç¯å¢ƒå˜é‡
- æ„å»ºå¹¶å¯åŠ¨æœåŠ¡

---

### æ–¹å¼ä¸‰ï¼šä¼ ç»Ÿæ–¹å¼éƒ¨ç½²ï¼ˆä¸ä½¿ç”¨ Dockerï¼‰

#### æ­¥éª¤ 1ï¼šå®‰è£…å¿…è¦è½¯ä»¶

```bash
# å®‰è£… Java 17
sudo apt install openjdk-17-jdk -y

# å®‰è£… Maven
sudo apt install maven -y

# å®‰è£… Node.js 20
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo bash -
sudo apt install -y nodejs

# å®‰è£… Nginx
sudo apt install nginx -y
```

#### æ­¥éª¤ 2ï¼šéƒ¨ç½²åç«¯

```bash
cd /opt/colorful-tibet/backend

# ç¼–è¯‘é¡¹ç›®
mvn clean package -DskipTests

# åˆ›å»ºè¿è¡Œç›®å½•
sudo mkdir -p /opt/colorful-tibet/run
sudo mkdir -p /opt/colorful-tibet/logs

# å¤åˆ¶ JAR æ–‡ä»¶
sudo cp target/tourism-0.0.1-SNAPSHOT.jar /opt/colorful-tibet/run/

# å¯åŠ¨æœåŠ¡ï¼ˆä½¿ç”¨ systemd æˆ–ç›´æ¥è¿è¡Œï¼‰
java -jar /opt/colorful-tibet/run/tourism-0.0.1-SNAPSHOT.jar --spring.profiles.active=prod
```

#### æ­¥éª¤ 3ï¼šéƒ¨ç½²å‰ç«¯

```bash
cd /opt/colorful-tibet/frontend

# å®‰è£…ä¾èµ–
npm install

# æ„å»ºé¡¹ç›®
VITE_API_BASE_URL=http://æ‚¨çš„æœåŠ¡å™¨IP:8080/api npm run build

# å¤åˆ¶åˆ° Nginx
sudo cp -r dist/* /var/www/html/
```

è¯¦ç»†æ­¥éª¤è¯·å‚è€ƒï¼š[éƒ¨ç½²æ•™ç¨‹-è…¾è®¯äº‘æœåŠ¡å™¨.md](./éƒ¨ç½²æ•™ç¨‹-è…¾è®¯äº‘æœåŠ¡å™¨.md)

---

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

### Docker æ–¹å¼

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
docker-compose logs backend
docker-compose logs frontend

# é‡å¯æœåŠ¡
docker-compose restart

# åœæ­¢æœåŠ¡
docker-compose down

# æ›´æ–°ä»£ç åé‡æ–°éƒ¨ç½²
git pull
docker-compose build
docker-compose up -d
```

### ä¼ ç»Ÿæ–¹å¼

```bash
# æŸ¥çœ‹åç«¯æ—¥å¿—
tail -f /opt/colorful-tibet/logs/backend.log

# é‡å¯ Nginx
sudo systemctl restart nginx

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status tibet-backend
```

---

## âš ï¸ é‡è¦æç¤º

1. **ç¯å¢ƒå˜é‡é…ç½®**ï¼šåŠ¡å¿…ä¿®æ”¹ `.env` æ–‡ä»¶ä¸­çš„ `DOUBAO_API_KEY`ã€`DOUBAO_API_URL` å’Œ `DOUBAO_MODEL`
2. **å®‰å…¨ç»„é…ç½®**ï¼šç¡®ä¿è…¾è®¯äº‘å®‰å…¨ç»„å·²å¼€æ”¾ 80ã€443ã€8080 ç«¯å£
3. **é˜²ç«å¢™é…ç½®**ï¼šç¡®ä¿æœåŠ¡å™¨é˜²ç«å¢™å…è®¸ç›¸åº”ç«¯å£
4. **å¯†é’¥å®‰å…¨**ï¼šç”Ÿäº§ç¯å¢ƒåŠ¡å¿…ä½¿ç”¨å¼ºéšæœºå¯†é’¥

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [éƒ¨ç½²æ•™ç¨‹-è…¾è®¯äº‘æœåŠ¡å™¨.md](./éƒ¨ç½²æ•™ç¨‹-è…¾è®¯äº‘æœåŠ¡å™¨.md) - è¯¦ç»†éƒ¨ç½²æ•™ç¨‹
- [å¿«é€Ÿéƒ¨ç½²æŒ‡å—.md](./å¿«é€Ÿéƒ¨ç½²æŒ‡å—.md) - å¿«é€Ÿéƒ¨ç½²æ–¹æ³•
- [ç¯å¢ƒå˜é‡é…ç½®è¯´æ˜.md](./ç¯å¢ƒå˜é‡é…ç½®è¯´æ˜.md) - ç¯å¢ƒå˜é‡è¯¦ç»†è¯´æ˜

---

**æ¨è**ï¼šä½¿ç”¨ Docker æ–¹å¼éƒ¨ç½²ï¼Œæœ€ç®€å•ä¸”ç¯å¢ƒéš”ç¦»ã€‚

