# è…¾è®¯äº‘éƒ¨ç½²è¯¦ç»†æ•™ç¨‹

æœ¬æ–‡æ¡£æä¾›åœ¨è…¾è®¯äº‘æœåŠ¡å™¨ä¸Šéƒ¨ç½²"å¤šå½©è¥¿è—"æ—…æ¸¸ç½‘ç«™çš„å®Œæ•´è¯¦ç»†æ•™ç¨‹ï¼Œé€‚åˆä»é›¶å¼€å§‹çš„ç”¨æˆ·ã€‚

## ğŸ“‹ ç›®å½•

1. [å‡†å¤‡å·¥ä½œ](#å‡†å¤‡å·¥ä½œ)
2. [æœåŠ¡å™¨ç¯å¢ƒå‡†å¤‡](#æœåŠ¡å™¨ç¯å¢ƒå‡†å¤‡)
3. [é¡¹ç›®ä»£ç éƒ¨ç½²](#é¡¹ç›®ä»£ç éƒ¨ç½²)
4. [Docker ç¯å¢ƒå®‰è£…](#docker-ç¯å¢ƒå®‰è£…)
5. [ç¯å¢ƒå˜é‡é…ç½®](#ç¯å¢ƒå˜é‡é…ç½®)
6. [æœåŠ¡å¯åŠ¨å’ŒéªŒè¯](#æœåŠ¡å¯åŠ¨å’ŒéªŒè¯)
7. [åŸŸåå’Œ SSL é…ç½®ï¼ˆå¯é€‰ï¼‰](#åŸŸåå’Œ-ssl-é…ç½®å¯é€‰)
8. [å¸¸è§é—®é¢˜æ’æŸ¥](#å¸¸è§é—®é¢˜æ’æŸ¥)
9. [æ—¥å¸¸ç»´æŠ¤å’Œæ›´æ–°](#æ—¥å¸¸ç»´æŠ¤å’Œæ›´æ–°)

---

## å‡†å¤‡å·¥ä½œ

### 1.1 è´­ä¹°è…¾è®¯äº‘æœåŠ¡å™¨

#### æœåŠ¡å™¨è§„æ ¼æ¨è

- **æœ€ä½é…ç½®**ï¼š
  - CPU: 2æ ¸
  - å†…å­˜: 4GB
  - ç¡¬ç›˜: 50GB SSD
  - å¸¦å®½: 3Mbps

- **æ¨èé…ç½®**ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰ï¼š
  - CPU: 4æ ¸
  - å†…å­˜: 8GB
  - ç¡¬ç›˜: 100GB SSD
  - å¸¦å®½: 5Mbps

#### æ“ä½œç³»ç»Ÿé€‰æ‹©

æ¨èä½¿ç”¨ä»¥ä¸‹æ“ä½œç³»ç»Ÿä¹‹ä¸€ï¼š
- **Ubuntu 22.04 LTS**ï¼ˆæ¨èï¼‰
- **Ubuntu 20.04 LTS**
- **CentOS 7.9**

æœ¬æ•™ç¨‹ä»¥ **Ubuntu 22.04** ä¸ºä¾‹ã€‚

#### è´­ä¹°æ­¥éª¤

1. ç™»å½•è…¾è®¯äº‘æ§åˆ¶å°
2. è¿›å…¥ã€Œäº‘æœåŠ¡å™¨ CVMã€é¡µé¢
3. ç‚¹å‡»ã€Œæ–°å»ºã€åˆ›å»ºå®ä¾‹
4. é€‰æ‹©é…ç½®ï¼š
   - åœ°åŸŸï¼šé€‰æ‹©ç¦»ç”¨æˆ·æœ€è¿‘çš„åœ°åŸŸ
   - æœºå‹ï¼šæ ‡å‡†å‹ S5
   - é•œåƒï¼šUbuntu Server 22.04 LTS 64ä½
   - ç³»ç»Ÿç›˜ï¼š50GB SSDäº‘ç¡¬ç›˜
   - ç½‘ç»œï¼šé»˜è®¤ç½‘ç»œ
   - å…¬ç½‘IPï¼šåˆ†é…å…¬ç½‘IP
   - å¸¦å®½ï¼šæŒ‰é‡è®¡è´¹ï¼Œ3Mbps
5. è®¾ç½®ç™»å½•æ–¹å¼ï¼š
   - æ¨èä½¿ç”¨ã€ŒSSHå¯†é’¥å¯¹ã€æˆ–ã€Œç«‹å³è®¾ç½®å¯†ç ã€
6. é…ç½®å®‰å…¨ç»„ï¼ˆè§ä¸‹ä¸€èŠ‚ï¼‰
7. å®Œæˆè´­ä¹°

### 1.2 é…ç½®å®‰å…¨ç»„è§„åˆ™

å®‰å…¨ç»„æ˜¯äº‘æœåŠ¡å™¨çš„é˜²ç«å¢™ï¼Œéœ€è¦å¼€æ”¾ä»¥ä¸‹ç«¯å£ï¼š

#### å¿…éœ€ç«¯å£

| ç«¯å£ | åè®® | è¯´æ˜ | æ¥æº |
|------|------|------|------|
| 22 | TCP | SSHè¿œç¨‹ç™»å½• | 0.0.0.0/0ï¼ˆå»ºè®®é™åˆ¶ä¸ºæ‚¨çš„IPï¼‰ |
| 80 | TCP | HTTPè®¿é—® | 0.0.0.0/0 |
| 443 | TCP | HTTPSè®¿é—® | 0.0.0.0/0 |
| 8080 | TCP | åç«¯APIï¼ˆå¯é€‰ï¼Œå¦‚æœä¸éœ€è¦å¤–éƒ¨ç›´æ¥è®¿é—®å¯å…³é—­ï¼‰ | 0.0.0.0/0 |

#### é…ç½®æ­¥éª¤

1. åœ¨äº‘æœåŠ¡å™¨æ§åˆ¶å°ï¼Œæ‰¾åˆ°æ‚¨çš„å®ä¾‹
2. ç‚¹å‡»ã€Œå®‰å…¨ç»„ã€æ ‡ç­¾
3. ç‚¹å‡»ã€Œä¿®æ”¹è§„åˆ™ã€
4. ç‚¹å‡»ã€Œæ·»åŠ è§„åˆ™ã€ï¼Œä¾æ¬¡æ·»åŠ ä¸Šè¿°ç«¯å£è§„åˆ™
5. ä¿å­˜è§„åˆ™

**å®‰å…¨å»ºè®®**ï¼š
- SSHç«¯å£ï¼ˆ22ï¼‰å»ºè®®åªå…è®¸æ‚¨çš„IPè®¿é—®
- ç”Ÿäº§ç¯å¢ƒå»ºè®®å…³é—­8080ç«¯å£çš„å¤–éƒ¨è®¿é—®ï¼Œåªå…è®¸é€šè¿‡80ç«¯å£è®¿é—®

### 1.3 å‡†å¤‡å¿…éœ€ä¿¡æ¯

éƒ¨ç½²å‰éœ€è¦å‡†å¤‡ä»¥ä¸‹ä¿¡æ¯ï¼š

- âœ… **æœåŠ¡å™¨IPåœ°å€**ï¼šåœ¨äº‘æœåŠ¡å™¨æ§åˆ¶å°æŸ¥çœ‹
- âœ… **SSHç™»å½•å‡­è¯**ï¼šå¯†ç æˆ–SSHå¯†é’¥
- âœ… **è±†åŒ…API Key**ï¼šç”¨äºAIæ¨èåŠŸèƒ½
- âœ… **è±†åŒ…API URL**ï¼šAPIæ¥å£åœ°å€
- âœ… **è±†åŒ…æ¨¡å‹åç§°**ï¼šä½¿ç”¨çš„æ¨¡å‹åç§°
- âœ… **åŸŸå**ï¼ˆå¯é€‰ï¼‰ï¼šå¦‚æœä½¿ç”¨åŸŸåè®¿é—®
- âœ… **Gitä»“åº“åœ°å€**ï¼ˆå¦‚æœä½¿ç”¨Gitéƒ¨ç½²ï¼‰

---

## æœåŠ¡å™¨ç¯å¢ƒå‡†å¤‡

### 2.1 è¿æ¥åˆ°æœåŠ¡å™¨

#### Windows ç”¨æˆ·

**æ–¹æ³•ä¸€ï¼šä½¿ç”¨ PowerShell**

```powershell
# ä½¿ç”¨å¯†ç ç™»å½•
ssh root@æ‚¨çš„æœåŠ¡å™¨IP

# æˆ–ä½¿ç”¨å¯†é’¥æ–‡ä»¶
ssh -i C:\path\to\your\key.pem root@æ‚¨çš„æœåŠ¡å™¨IP
```

**æ–¹æ³•äºŒï¼šä½¿ç”¨ PuTTY**

1. ä¸‹è½½å¹¶å®‰è£… PuTTY
2. è¾“å…¥æœåŠ¡å™¨IPåœ°å€
3. é€‰æ‹©è¿æ¥ç±»å‹ï¼šSSH
4. ç‚¹å‡»ã€Œæ‰“å¼€ã€
5. è¾“å…¥ç”¨æˆ·åï¼ˆrootï¼‰å’Œå¯†ç 

#### Mac/Linux ç”¨æˆ·

```bash
# ä½¿ç”¨å¯†ç ç™»å½•
ssh root@æ‚¨çš„æœåŠ¡å™¨IP

# æˆ–ä½¿ç”¨å¯†é’¥æ–‡ä»¶
ssh -i ~/.ssh/your_key.pem root@æ‚¨çš„æœåŠ¡å™¨IP
```

#### âš ï¸ SSH è¿æ¥å¸¸è§é—®é¢˜

**é—®é¢˜1ï¼šä¸»æœºå¯†é’¥å·²æ›´æ”¹è­¦å‘Š**

å¦‚æœçœ‹åˆ° `WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!` é”™è¯¯ï¼Œè¿™é€šå¸¸å‘ç”Ÿåœ¨ï¼š
- æœåŠ¡å™¨é‡è£…ç³»ç»Ÿå
- æœåŠ¡å™¨æ›´æ¢äº†SSHå¯†é’¥
- æœåŠ¡å™¨IPè¢«é‡æ–°åˆ†é…

**è§£å†³æ–¹æ³•ï¼ˆWindows PowerShellï¼‰ï¼š**

```powershell
# æ–¹æ³•1ï¼šåˆ é™¤known_hostsæ–‡ä»¶ä¸­çš„æ—§å¯†é’¥ï¼ˆæ¨èï¼‰
ssh-keygen -R 1.15.29.168

# æ–¹æ³•2ï¼šæ‰‹åŠ¨ç¼–è¾‘known_hostsæ–‡ä»¶ï¼Œåˆ é™¤ç¬¬3è¡Œï¼ˆæ ¹æ®é”™è¯¯æç¤ºï¼‰
notepad C:\Users\Suli\.ssh\known_hosts
# åˆ é™¤åŒ…å«è¯¥IPåœ°å€çš„è¡Œï¼Œä¿å­˜åé‡è¯•

# æ–¹æ³•3ï¼šä¸´æ—¶è·³è¿‡ä¸»æœºå¯†é’¥æ£€æŸ¥ï¼ˆä¸æ¨èï¼Œä»…ç”¨äºæµ‹è¯•ï¼‰
ssh -o StrictHostKeyChecking=no root@1.15.29.168
```

**è§£å†³æ–¹æ³•ï¼ˆMac/Linuxï¼‰ï¼š**

```bash
# åˆ é™¤æ—§å¯†é’¥
ssh-keygen -R 1.15.29.168

# æˆ–æ‰‹åŠ¨ç¼–è¾‘
nano ~/.ssh/known_hosts
# åˆ é™¤åŒ…å«è¯¥IPçš„è¡Œï¼Œä¿å­˜åé‡è¯•
```

åˆ é™¤æ—§å¯†é’¥åï¼Œé‡æ–°è¿æ¥æ—¶ä¼šæç¤ºæ¥å—æ–°çš„ä¸»æœºå¯†é’¥ï¼Œè¾“å…¥ `yes` å³å¯ã€‚

**é—®é¢˜2ï¼šè¿æ¥è¶…æ—¶**

```powershell
# æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
ping 1.15.29.168

# æ£€æŸ¥ç«¯å£æ˜¯å¦å¼€æ”¾
Test-NetConnection -ComputerName 1.15.29.168 -Port 22
```

**é—®é¢˜3ï¼šæƒé™è¢«æ‹’ç»ï¼ˆPermission deniedï¼‰**

å¦‚æœçœ‹åˆ° `Permission denied, please try again.` é”™è¯¯ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ’æŸ¥ï¼š

**æ­¥éª¤1ï¼šç¡®è®¤ç”¨æˆ·å**

ä¸åŒæ“ä½œç³»ç»Ÿçš„é»˜è®¤ç”¨æˆ·åå¯èƒ½ä¸åŒï¼š
- **Ubuntu**: é€šå¸¸æ˜¯ `ubuntu`ï¼ˆä¸æ˜¯ `root`ï¼‰
- **CentOS**: é€šå¸¸æ˜¯ `root`
- **Debian**: é€šå¸¸æ˜¯ `root`

å°è¯•ä¸åŒçš„ç”¨æˆ·åï¼š
```powershell
# å°è¯• ubuntu ç”¨æˆ·ï¼ˆUbuntuç³»ç»Ÿå¸¸è§ï¼‰
ssh ubuntu@1.15.29.168

# æˆ–å°è¯• root ç”¨æˆ·
ssh root@1.15.29.168
```

**æ­¥éª¤2ï¼šç¡®è®¤å¯†ç **

- å¯†ç è¾“å…¥æ—¶**ä¸ä¼šæ˜¾ç¤ºä»»ä½•å­—ç¬¦**ï¼ˆåŒ…æ‹¬æ˜Ÿå·ï¼‰ï¼Œè¿™æ˜¯æ­£å¸¸çš„å®‰å…¨æœºåˆ¶
- ç¡®è®¤å¯†ç æ˜¯å¦æ­£ç¡®ï¼ˆæ³¨æ„å¤§å°å†™ã€ç‰¹æ®Šå­—ç¬¦ï¼‰
- å¦‚æœæ˜¯åœ¨è…¾è®¯äº‘è´­ä¹°çš„æœåŠ¡å™¨ï¼Œå¯†ç é€šå¸¸åœ¨ï¼š
  - è´­ä¹°æ—¶è®¾ç½®çš„å¯†ç 
  - æ§åˆ¶å°ã€Œå®ä¾‹ã€â†’ã€Œé‡ç½®å¯†ç ã€ä¸­è®¾ç½®çš„å¯†ç 

**æ­¥éª¤3ï¼šé‡ç½®æœåŠ¡å™¨å¯†ç **

å¦‚æœå¿˜è®°å¯†ç ï¼Œå¯ä»¥åœ¨è…¾è®¯äº‘æ§åˆ¶å°é‡ç½®ï¼š

1. ç™»å½•è…¾è®¯äº‘æ§åˆ¶å°
2. è¿›å…¥ã€Œäº‘æœåŠ¡å™¨ CVMã€â†’ã€Œå®ä¾‹ã€
3. æ‰¾åˆ°æ‚¨çš„æœåŠ¡å™¨ï¼Œç‚¹å‡»ã€Œæ›´å¤šã€â†’ã€Œå¯†ç /å¯†é’¥ã€â†’ã€Œé‡ç½®å¯†ç ã€
4. è®¾ç½®æ–°å¯†ç ï¼ˆéœ€è¦é‡å¯æœåŠ¡å™¨ç”Ÿæ•ˆï¼‰
5. é‡å¯æœåŠ¡å™¨åï¼Œä½¿ç”¨æ–°å¯†ç ç™»å½•

**æ­¥éª¤4ï¼šæ£€æŸ¥æ˜¯å¦ä½¿ç”¨SSHå¯†é’¥**

å¦‚æœæœåŠ¡å™¨é…ç½®äº†SSHå¯†é’¥ç™»å½•ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨å¯†é’¥æ–‡ä»¶ï¼š

```powershell
# ä½¿ç”¨å¯†é’¥æ–‡ä»¶ç™»å½•
ssh -i C:\path\to\your\key.pem ubuntu@1.15.29.168

# æˆ– root ç”¨æˆ·
ssh -i C:\path\to\your\key.pem root@1.15.29.168
```

**æ­¥éª¤5ï¼šä½¿ç”¨è…¾è®¯äº‘æ§åˆ¶å°ç™»å½•ï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼‰**

å¦‚æœSSHæ— æ³•è¿æ¥ï¼Œå¯ä»¥ï¼š
1. åœ¨è…¾è®¯äº‘æ§åˆ¶å°æ‰¾åˆ°æ‚¨çš„æœåŠ¡å™¨
2. ç‚¹å‡»ã€Œç™»å½•ã€æŒ‰é’®
3. ä½¿ç”¨æµè§ˆå™¨æ§åˆ¶å°ç™»å½•ï¼ˆVNCæ–¹å¼ï¼‰
4. ç™»å½•åå¯ä»¥é‡ç½®å¯†ç æˆ–é…ç½®SSHå¯†é’¥

**æ­¥éª¤6ï¼šæ£€æŸ¥å®‰å…¨ç»„è®¾ç½®**

ç¡®è®¤å®‰å…¨ç»„å·²å¼€æ”¾22ç«¯å£ï¼š
- åœ¨è…¾è®¯äº‘æ§åˆ¶å°æ£€æŸ¥å®‰å…¨ç»„è§„åˆ™
- ç¡®ä¿22ç«¯å£å¯¹æ‚¨çš„IPå¼€æ”¾ï¼ˆæˆ–0.0.0.0/0å¼€æ”¾ï¼‰

**å¸¸è§é”™è¯¯ç¤ºä¾‹ï¼š**

```powershell
# âŒ é”™è¯¯ï¼šç”¨æˆ·åå¯èƒ½ä¸å¯¹
ssh root@1.15.29.168  # å¦‚æœç³»ç»Ÿé»˜è®¤ç”¨æˆ·æ˜¯ ubuntuï¼Œè¿™ä¼šå¤±è´¥

# âœ… æ­£ç¡®ï¼šå°è¯• ubuntu ç”¨æˆ·
ssh ubuntu@1.15.29.168

# âœ… å¦‚æœè®¾ç½®äº†å¯†é’¥ï¼Œä½¿ç”¨å¯†é’¥ç™»å½•
ssh -i your-key.pem ubuntu@1.15.29.168
```

### 2.2 æ›´æ–°ç³»ç»Ÿ

é¦–æ¬¡ç™»å½•åï¼Œå…ˆæ›´æ–°ç³»ç»Ÿï¼š

```bash
# æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨
apt update

# å‡çº§å·²å®‰è£…çš„è½¯ä»¶åŒ…
apt upgrade -y

# å®‰è£…å¸¸ç”¨å·¥å…·
apt install -y curl wget git vim net-tools
```

### 2.3 åˆ›å»ºérootç”¨æˆ·ï¼ˆæ¨èï¼Œå¯é€‰ï¼‰

ä¸ºäº†å®‰å…¨ï¼Œå»ºè®®åˆ›å»ºæ™®é€šç”¨æˆ·ï¼š

```bash
# åˆ›å»ºç”¨æˆ·ï¼ˆæ›¿æ¢ your_username ä¸ºæ‚¨çš„ç”¨æˆ·åï¼‰
adduser your_username

# å°†ç”¨æˆ·æ·»åŠ åˆ°sudoç»„
usermod -aG sudo your_username

# åˆ‡æ¢åˆ°æ–°ç”¨æˆ·
su - your_username
```

---

## é¡¹ç›®ä»£ç éƒ¨ç½²

### 3.1 æ–¹æ³•ä¸€ï¼šä½¿ç”¨ Git å…‹éš†ï¼ˆæ¨èï¼‰

#### æ­¥éª¤ 1ï¼šåˆ›å»ºé¡¹ç›®ç›®å½•

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
sudo mkdir -p /opt/colorful-tibet
sudo chown -R $USER:$USER /opt/colorful-tibet
cd /opt/colorful-tibet
```

#### æ­¥éª¤ 2ï¼šå…‹éš†ä»£ç 

```bash
# å…¬å¼€ä»“åº“
git clone https://github.com/suli9710/colorful-tibet.git .

# æˆ–ç§æœ‰ä»“åº“ï¼ˆéœ€è¦é…ç½®SSHå¯†é’¥æˆ–ä½¿ç”¨HTTPSè®¤è¯ï¼‰
git clone git@github.com:suli9710/colorful-tibet.git .
```

#### æ­¥éª¤ 3ï¼šæ£€æŸ¥ä»£ç 

```bash
# æŸ¥çœ‹é¡¹ç›®ç»“æ„
ls -la

# åº”è¯¥çœ‹åˆ°ä»¥ä¸‹ç›®å½•ï¼š
# backend/  frontend/  docker-compose.yml  deploy-tencent-cloud.sh ç­‰
```

### 3.2 æ–¹æ³•äºŒï¼šä½¿ç”¨ SCP ä¸Šä¼ 

å¦‚æœæ‚¨åœ¨æœ¬åœ°æœ‰é¡¹ç›®ä»£ç ï¼Œå¯ä»¥ä½¿ç”¨ SCP ä¸Šä¼ ï¼š

#### Windows PowerShell

```powershell
# ä¸Šä¼ æ•´ä¸ªé¡¹ç›®ç›®å½•
scp -r C:\Users\Suli\Desktop\colorful-tibet root@æ‚¨çš„æœåŠ¡å™¨IP:/opt/
```

#### Mac/Linux

```bash
# ä¸Šä¼ æ•´ä¸ªé¡¹ç›®ç›®å½•
scp -r ~/Desktop/colorful-tibet root@æ‚¨çš„æœåŠ¡å™¨IP:/opt/
```

#### åœ¨æœåŠ¡å™¨ä¸ŠéªŒè¯

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /opt/colorful-tibet

# æ£€æŸ¥æ–‡ä»¶
ls -la
```

### 3.3 è®¾ç½®æ–‡ä»¶æƒé™

```bash
cd /opt/colorful-tibet

# ç»™éƒ¨ç½²è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™
chmod +x deploy-tencent-cloud.sh
chmod +x deploy.sh

# ç¡®ä¿å½“å‰ç”¨æˆ·æ‹¥æœ‰é¡¹ç›®ç›®å½•
sudo chown -R $USER:$USER /opt/colorful-tibet
```

---

## Docker ç¯å¢ƒå®‰è£…

### 4.1 å®‰è£… Docker

#### æ–¹æ³•ä¸€ï¼šä½¿ç”¨å®˜æ–¹å®‰è£…è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# ä¸‹è½½å¹¶è¿è¡ŒDockerå®‰è£…è„šæœ¬
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# å¯åŠ¨DockeræœåŠ¡
sudo systemctl start docker
sudo systemctl enable docker

# éªŒè¯å®‰è£…
docker --version
```

#### æ–¹æ³•äºŒï¼šä½¿ç”¨åŒ…ç®¡ç†å™¨å®‰è£…

```bash
# æ›´æ–°è½¯ä»¶åŒ…ç´¢å¼•
sudo apt update

# å®‰è£…å¿…è¦çš„ä¾èµ–
sudo apt install -y ca-certificates curl gnupg lsb-release

# æ·»åŠ Dockerå®˜æ–¹GPGå¯†é’¥
sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg

# è®¾ç½®ä»“åº“
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
  $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

# å®‰è£…Docker Engine
sudo apt update
sudo apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

# å¯åŠ¨DockeræœåŠ¡
sudo systemctl start docker
sudo systemctl enable docker

# éªŒè¯å®‰è£…
docker --version
```

### 4.2 é…ç½® Dockerï¼ˆå¯é€‰ï¼‰

#### å°†ç”¨æˆ·æ·»åŠ åˆ°dockerç»„

è¿™æ ·å°±ä¸éœ€è¦æ¯æ¬¡éƒ½ç”¨sudoï¼š

```bash
# å°†å½“å‰ç”¨æˆ·æ·»åŠ åˆ°dockerç»„
sudo usermod -aG docker $USER

# é‡æ–°ç™»å½•æˆ–æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä½¿é…ç½®ç”Ÿæ•ˆ
newgrp docker

# éªŒè¯ï¼ˆä¸éœ€è¦sudoï¼‰
docker ps
```

#### é…ç½®Dockeré•œåƒåŠ é€Ÿï¼ˆå¯é€‰ï¼Œæ¨èï¼‰

å¦‚æœä¸‹è½½é•œåƒè¾ƒæ…¢ï¼Œå¯ä»¥é…ç½®å›½å†…é•œåƒæºï¼š

```bash
# åˆ›å»ºæˆ–ç¼–è¾‘daemon.json
sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json <<-'EOF'
{
  "registry-mirrors": [
    "https://docker.mirrors.ustc.edu.cn",
    "https://hub-mirror.c.163.com",
    "https://mirror.baidubce.com"
  ]
}
EOF

# é‡å¯DockeræœåŠ¡
sudo systemctl daemon-reload
sudo systemctl restart docker

# éªŒè¯é…ç½®
docker info | grep -A 10 "Registry Mirrors"
```

### 4.3 å®‰è£… Docker Compose

Docker Compose V2 é€šå¸¸éš Docker ä¸€èµ·å®‰è£…ã€‚éªŒè¯æ˜¯å¦å·²å®‰è£…ï¼š

```bash
# æ£€æŸ¥Docker Composeç‰ˆæœ¬
docker compose version
```

å¦‚æœæœªå®‰è£…ï¼Œå¯ä»¥æ‰‹åŠ¨å®‰è£…ï¼š

```bash
# å®‰è£…Docker Composeæ’ä»¶
sudo apt install -y docker-compose-plugin

# éªŒè¯å®‰è£…
docker compose version
```

---

## ç¯å¢ƒå˜é‡é…ç½®

### 5.1 åˆ›å»º .env æ–‡ä»¶

```bash
cd /opt/colorful-tibet

# åˆ›å»º.envæ–‡ä»¶
nano .env
```

### 5.2 é…ç½®å¿…éœ€çš„ç¯å¢ƒå˜é‡

åœ¨ç¼–è¾‘å™¨ä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼ˆ**è¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…å€¼**ï¼‰ï¼š

```env
# ============================================
# è±†åŒ… API é…ç½®ï¼ˆå¿…éœ€ï¼‰
# ============================================
DOUBAO_API_KEY=your-doubao-api-key-here
DOUBAO_API_URL=https://ark.cn-beijing.volces.com/api/v3/chat/completions
DOUBAO_MODEL=your-model-name-here

# ============================================
# JWT é…ç½®ï¼ˆå¿…éœ€ï¼‰
# ============================================
# ç”Ÿæˆæ–¹æ³•: openssl rand -hex 32
JWT_SECRET=your-generated-jwt-secret-key-here

# ============================================
# ç®¡ç†å‘˜åŠ å¯†å¯†é’¥ï¼ˆå¿…éœ€ï¼‰
# ============================================
# ç”Ÿæˆæ–¹æ³•: openssl rand -hex 32
ADMIN_ENCRYPTION_KEY=your-generated-admin-encryption-key-here

# ============================================
# å‰ç«¯ API åœ°å€ï¼ˆå¿…éœ€ï¼‰
# ============================================
# æ›¿æ¢ä¸ºæ‚¨çš„æœåŠ¡å™¨IPæˆ–åŸŸå
VITE_API_BASE_URL=http://æ‚¨çš„æœåŠ¡å™¨IP:8080/api

# ============================================
# Spring Profileï¼ˆå¯é€‰ï¼‰
# ============================================
# local: ä½¿ç”¨H2å†…å­˜æ•°æ®åº“ï¼ˆå¼€å‘/æµ‹è¯•ï¼‰
# prod: ä½¿ç”¨MySQLæ•°æ®åº“ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
SPRING_PROFILES_ACTIVE=local
```

### 5.3 ç”Ÿæˆéšæœºå¯†é’¥

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç”Ÿæˆå®‰å…¨çš„éšæœºå¯†é’¥ï¼š

```bash
# ç”ŸæˆJWTå¯†é’¥
openssl rand -hex 32

# ç”Ÿæˆç®¡ç†å‘˜åŠ å¯†å¯†é’¥
openssl rand -hex 32
```

å°†ç”Ÿæˆçš„å¯†é’¥å¤åˆ¶åˆ° `.env` æ–‡ä»¶ä¸­ã€‚

### 5.4 è·å–æœåŠ¡å™¨IPåœ°å€

```bash
# æ–¹æ³•1ï¼šæŸ¥çœ‹å…¬ç½‘IP
curl ifconfig.me

# æ–¹æ³•2ï¼šæŸ¥çœ‹å†…ç½‘IP
hostname -I

# æ–¹æ³•3ï¼šåœ¨è…¾è®¯äº‘æ§åˆ¶å°æŸ¥çœ‹
```

å°†å…¬ç½‘IPå¡«å…¥ `VITE_API_BASE_URL`ã€‚

### 5.5 ä¿å­˜å¹¶éªŒè¯é…ç½®

```bash
# ä¿å­˜æ–‡ä»¶ï¼ˆåœ¨nanoä¸­ï¼šCtrl+Oä¿å­˜ï¼ŒCtrl+Xé€€å‡ºï¼‰

# éªŒè¯æ–‡ä»¶å†…å®¹
cat .env

# æ£€æŸ¥æ–‡ä»¶æƒé™ï¼ˆç¡®ä¿åªæœ‰æ‰€æœ‰è€…å¯è¯»ï¼‰
chmod 600 .env
ls -la .env
```

---

## æœåŠ¡å¯åŠ¨å’ŒéªŒè¯

### 6.1 ä½¿ç”¨ä¸€é”®éƒ¨ç½²è„šæœ¬ï¼ˆæ¨èï¼‰

é¡¹ç›®æä¾›äº†è‡ªåŠ¨éƒ¨ç½²è„šæœ¬ï¼Œå¯ä»¥è‡ªåŠ¨å®Œæˆå¤§éƒ¨åˆ†é…ç½®ï¼š

```bash
cd /opt/colorful-tibet

# å¦‚æœä½¿ç”¨rootç”¨æˆ·
./deploy-tencent-cloud.sh

# å¦‚æœä½¿ç”¨æ™®é€šç”¨æˆ·ï¼Œéœ€è¦sudo
sudo ./deploy-tencent-cloud.sh
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- âœ… æ£€æŸ¥å¹¶å®‰è£…Docker
- âœ… æ£€æŸ¥Docker Compose
- âœ… é…ç½®é˜²ç«å¢™è§„åˆ™
- âœ… åˆ›å»ºå¿…è¦çš„ç›®å½•
- âœ… ç”Ÿæˆç¯å¢ƒå˜é‡æ–‡ä»¶ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
- âœ… æ›´æ–°docker-compose.ymlé…ç½®
- âœ… æ„å»ºDockeré•œåƒ
- âœ… å¯åŠ¨æœåŠ¡

### 6.2 æ‰‹åŠ¨å¯åŠ¨æœåŠ¡

å¦‚æœè‡ªåŠ¨è„šæœ¬æ— æ³•ä½¿ç”¨ï¼Œå¯ä»¥æ‰‹åŠ¨å¯åŠ¨ï¼š

#### æ­¥éª¤ 1ï¼šæ›´æ–° docker-compose.ymlï¼ˆå¦‚æœéœ€è¦ï¼‰

ç¼–è¾‘ `docker-compose.yml`ï¼Œç¡®ä¿ `VITE_API_BASE_URL` æ­£ç¡®ï¼š

```bash
nano docker-compose.yml
```

æ‰¾åˆ° `frontend` æœåŠ¡çš„ `args` éƒ¨åˆ†ï¼Œç¡®ä¿ï¼š

```yaml
args:
  - VITE_API_BASE_URL=${VITE_API_BASE_URL:-/api}
```

#### æ­¥éª¤ 2ï¼šæ„å»ºé•œåƒ

```bash
cd /opt/colorful-tibet

# æ„å»ºæ‰€æœ‰æœåŠ¡é•œåƒï¼ˆé¦–æ¬¡æ„å»ºå¯èƒ½éœ€è¦10-20åˆ†é’Ÿï¼‰
docker compose build

# æˆ–åªæ„å»ºç‰¹å®šæœåŠ¡
docker compose build backend
docker compose build frontend
```

#### æ­¥éª¤ 3ï¼šå¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆåå°è¿è¡Œï¼‰
docker compose up -d

# æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
docker compose logs -f
```

#### æ­¥éª¤ 4ï¼šæ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker compose ps

# åº”è¯¥çœ‹åˆ°ä¸¤ä¸ªå®¹å™¨éƒ½åœ¨è¿è¡Œï¼š
# colorful-tibet-backend   Up
# colorful-tibet-frontend  Up
```

### 6.3 éªŒè¯æœåŠ¡

#### æ£€æŸ¥åç«¯æœåŠ¡

```bash
# æ–¹æ³•1ï¼šæ£€æŸ¥å®¹å™¨æ—¥å¿—
docker compose logs backend

# æ–¹æ³•2ï¼šæµ‹è¯•APIæ¥å£
curl http://localhost:8080/api/spots

# æ–¹æ³•3ï¼šæ£€æŸ¥å¥åº·çŠ¶æ€
curl http://localhost:8080/api/health
```

å¦‚æœçœ‹åˆ°JSONæ•°æ®è¿”å›ï¼Œè¯´æ˜åç«¯æ­£å¸¸è¿è¡Œã€‚

#### æ£€æŸ¥å‰ç«¯æœåŠ¡

```bash
# æ–¹æ³•1ï¼šæ£€æŸ¥å®¹å™¨æ—¥å¿—
docker compose logs frontend

# æ–¹æ³•2ï¼šæµ‹è¯•HTTPå“åº”
curl http://localhost

# åº”è¯¥è¿”å›HTMLå†…å®¹
```

#### æ£€æŸ¥å¤–éƒ¨è®¿é—®

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š
- **å‰ç«¯**: http://æ‚¨çš„æœåŠ¡å™¨IP
- **åç«¯API**: http://æ‚¨çš„æœåŠ¡å™¨IP:8080/api/spots

å¦‚æœèƒ½çœ‹åˆ°é¡µé¢æˆ–æ•°æ®ï¼Œè¯´æ˜éƒ¨ç½²æˆåŠŸï¼

### 6.4 æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker compose logs -f

# æŸ¥çœ‹åç«¯æ—¥å¿—
docker compose logs -f backend

# æŸ¥çœ‹å‰ç«¯æ—¥å¿—
docker compose logs -f frontend

# æŸ¥çœ‹æœ€è¿‘100è¡Œæ—¥å¿—
docker compose logs --tail=100 backend
```

---

## åŸŸåå’Œ SSL é…ç½®ï¼ˆå¯é€‰ï¼‰

### 7.1 é…ç½®åŸŸåè§£æ

1. ç™»å½•æ‚¨çš„åŸŸåæœåŠ¡å•†ï¼ˆå¦‚è…¾è®¯äº‘ã€é˜¿é‡Œäº‘ç­‰ï¼‰
2. æ·»åŠ Aè®°å½•ï¼š
   - ä¸»æœºè®°å½•ï¼š`@` æˆ– `www`
   - è®°å½•ç±»å‹ï¼šA
   - è®°å½•å€¼ï¼šæ‚¨çš„æœåŠ¡å™¨IPåœ°å€
   - TTLï¼š600ï¼ˆ10åˆ†é’Ÿï¼‰

3. ç­‰å¾…DNSè§£æç”Ÿæ•ˆï¼ˆé€šå¸¸å‡ åˆ†é’Ÿåˆ°å‡ å°æ—¶ï¼‰

### 7.2 å®‰è£… Certbotï¼ˆLet's Encryptï¼‰

```bash
# å®‰è£…Certbot
sudo apt update
sudo apt install -y certbot python3-certbot-nginx

# éªŒè¯å®‰è£…
certbot --version
```

### 7.3 é…ç½® Nginxï¼ˆå¦‚æœéœ€è¦ï¼‰

å¦‚æœä½¿ç”¨åŸŸåï¼Œéœ€è¦é…ç½®Nginxåå‘ä»£ç†ã€‚é¦–å…ˆå®‰è£…Nginxï¼š

```bash
sudo apt install -y nginx
```

åˆ›å»ºNginxé…ç½®æ–‡ä»¶ï¼š

```bash
sudo nano /etc/nginx/sites-available/colorful-tibet
```

æ·»åŠ ä»¥ä¸‹é…ç½®ï¼ˆæ›¿æ¢ `your-domain.com` ä¸ºæ‚¨çš„åŸŸåï¼‰ï¼š

```nginx
server {
    listen 80;
    server_name your-domain.com www.your-domain.com;

    # å‰ç«¯
    location / {
        proxy_pass http://localhost:80;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # åç«¯API
    location /api {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

å¯ç”¨é…ç½®ï¼š

```bash
# åˆ›å»ºç¬¦å·é“¾æ¥
sudo ln -s /etc/nginx/sites-available/colorful-tibet /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡è½½Nginx
sudo systemctl reload nginx
```

### 7.4 ç”³è¯· SSL è¯ä¹¦

```bash
# ç”³è¯·è¯ä¹¦ï¼ˆæ›¿æ¢ä¸ºæ‚¨çš„åŸŸåå’Œé‚®ç®±ï¼‰
sudo certbot --nginx -d your-domain.com -d www.your-domain.com

# æŒ‰ç…§æç¤ºæ“ä½œï¼š
# 1. è¾“å…¥é‚®ç®±åœ°å€
# 2. åŒæ„æœåŠ¡æ¡æ¬¾
# 3. é€‰æ‹©æ˜¯å¦æ¥æ”¶é‚®ä»¶é€šçŸ¥
# 4. Certbotä¼šè‡ªåŠ¨é…ç½®SSL
```

### 7.5 æ›´æ–°ç¯å¢ƒå˜é‡

ç”³è¯·SSLè¯ä¹¦åï¼Œæ›´æ–° `.env` æ–‡ä»¶ï¼š

```bash
nano /opt/colorful-tibet/.env
```

ä¿®æ”¹ `VITE_API_BASE_URL`ï¼š

```env
VITE_API_BASE_URL=https://your-domain.com/api
```

é‡æ–°æ„å»ºå‰ç«¯é•œåƒï¼š

```bash
cd /opt/colorful-tibet
docker compose build frontend
docker compose up -d frontend
```

### 7.6 è‡ªåŠ¨ç»­æœŸè¯ä¹¦

Let's Encryptè¯ä¹¦æœ‰æ•ˆæœŸ90å¤©ï¼Œè®¾ç½®è‡ªåŠ¨ç»­æœŸï¼š

```bash
# æµ‹è¯•ç»­æœŸ
sudo certbot renew --dry-run

# è¯ä¹¦ä¼šè‡ªåŠ¨ç»­æœŸï¼ˆcertbotå·²é…ç½®å®šæ—¶ä»»åŠ¡ï¼‰
```

---

## å¸¸è§é—®é¢˜æ’æŸ¥

### 8.1 æœåŠ¡æ— æ³•å¯åŠ¨

#### é—®é¢˜ï¼šå®¹å™¨å¯åŠ¨åç«‹å³é€€å‡º

```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker compose logs backend
docker compose logs frontend

# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker compose ps -a

# æŸ¥çœ‹å®¹å™¨é€€å‡ºä»£ç 
docker inspect colorful-tibet-backend | grep -A 10 "State"
```

**å¸¸è§åŸå› **ï¼š
- ç¯å¢ƒå˜é‡é…ç½®é”™è¯¯
- ç«¯å£è¢«å ç”¨
- é•œåƒæ„å»ºå¤±è´¥

#### è§£å†³æ–¹æ¡ˆ

```bash
# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tlnp | grep 8080
sudo netstat -tlnp | grep 80

# å¦‚æœç«¯å£è¢«å ç”¨ï¼Œåœæ­¢å ç”¨è¿›ç¨‹æˆ–ä¿®æ”¹docker-compose.ymlä¸­çš„ç«¯å£æ˜ å°„

# é‡æ–°æ„å»ºé•œåƒ
docker compose build --no-cache

# é‡æ–°å¯åŠ¨
docker compose up -d
```

### 8.2 å‰ç«¯æ— æ³•è®¿é—®åç«¯

#### é—®é¢˜ï¼šå‰ç«¯é¡µé¢æ˜¾ç¤ºAPIé”™è¯¯

**æ£€æŸ¥æ­¥éª¤**ï¼š

1. **æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ**ï¼š
```bash
curl http://localhost:8080/api/spots
```

2. **æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®**ï¼š
```bash
cat .env | grep VITE_API_BASE_URL
```

3. **æ£€æŸ¥å‰ç«¯æ„å»ºæ—¶çš„APIåœ°å€**ï¼š
```bash
docker compose config | grep VITE_API_BASE_URL
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

å¦‚æœ `VITE_API_BASE_URL` é…ç½®é”™è¯¯ï¼Œéœ€è¦é‡æ–°æ„å»ºå‰ç«¯ï¼š

```bash
# ä¿®æ”¹.envæ–‡ä»¶
nano .env

# é‡æ–°æ„å»ºå‰ç«¯é•œåƒ
docker compose build frontend

# é‡å¯å‰ç«¯å®¹å™¨
docker compose up -d frontend
```

### 8.3 æ•°æ®åº“è¿æ¥å¤±è´¥

#### é—®é¢˜ï¼šåç«¯æ—¥å¿—æ˜¾ç¤ºæ•°æ®åº“è¿æ¥é”™è¯¯

**å¦‚æœä½¿ç”¨H2æ•°æ®åº“ï¼ˆlocal profileï¼‰**ï¼š

æ£€æŸ¥ `application-local.yml` é…ç½®æ˜¯å¦æ­£ç¡®ã€‚

**å¦‚æœä½¿ç”¨MySQLï¼ˆprod profileï¼‰**ï¼š

1. **æ£€æŸ¥MySQLæœåŠ¡**ï¼š
```bash
# å¦‚æœMySQLåœ¨Dockerå®¹å™¨ä¸­
docker compose ps mysql

# å¦‚æœMySQLåœ¨å®¿ä¸»æœº
sudo systemctl status mysql
```

2. **æ£€æŸ¥æ•°æ®åº“é…ç½®**ï¼š
```bash
cat .env | grep DB_
```

3. **æµ‹è¯•æ•°æ®åº“è¿æ¥**ï¼š
```bash
mysql -h localhost -u tibet_user -p tibet_tourism
```

### 8.4 å†…å­˜ä¸è¶³

#### é—®é¢˜ï¼šæœåŠ¡è¿è¡Œç¼“æ…¢æˆ–å´©æºƒ

```bash
# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
free -h

# æŸ¥çœ‹Dockerèµ„æºä½¿ç”¨
docker stats

# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
htop  # éœ€è¦å®‰è£…: apt install htop
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. å¢åŠ æœåŠ¡å™¨å†…å­˜
2. ä¼˜åŒ–Dockerèµ„æºé™åˆ¶
3. å…³é—­ä¸å¿…è¦çš„æœåŠ¡

### 8.5 é˜²ç«å¢™é—®é¢˜

#### é—®é¢˜ï¼šå¤–éƒ¨æ— æ³•è®¿é—®æœåŠ¡

```bash
# æ£€æŸ¥UFWé˜²ç«å¢™çŠ¶æ€
sudo ufw status

# æ£€æŸ¥iptablesè§„åˆ™
sudo iptables -L -n

# æ£€æŸ¥è…¾è®¯äº‘å®‰å…¨ç»„é…ç½®ï¼ˆåœ¨æ§åˆ¶å°æ£€æŸ¥ï¼‰
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# å¼€æ”¾ç«¯å£
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw allow 8080/tcp

# å¯ç”¨é˜²ç«å¢™
sudo ufw enable
```

### 8.6 Dockeré•œåƒä¸‹è½½æ…¢

**è§£å†³æ–¹æ¡ˆ**ï¼šé…ç½®é•œåƒåŠ é€Ÿï¼ˆè§4.2èŠ‚ï¼‰

### 8.7 æƒé™é—®é¢˜

#### é—®é¢˜ï¼šPermission denied

```bash
# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la /opt/colorful-tibet

# ä¿®æ”¹æ‰€æœ‰è€…
sudo chown -R $USER:$USER /opt/colorful-tibet

# æ£€æŸ¥Dockeræƒé™
docker ps  # å¦‚æœå¤±è´¥ï¼Œéœ€è¦å°†ç”¨æˆ·æ·»åŠ åˆ°dockerç»„
```

---

## æ—¥å¸¸ç»´æŠ¤å’Œæ›´æ–°

### 9.1 æ›´æ–°ä»£ç 

#### æ–¹æ³•ä¸€ï¼šä½¿ç”¨Gitï¼ˆæ¨èï¼‰

```bash
cd /opt/colorful-tibet

# æ‹‰å–æœ€æ–°ä»£ç 
git pull

# é‡æ–°æ„å»ºé•œåƒ
docker compose build

# é‡å¯æœåŠ¡
docker compose up -d
```

#### æ–¹æ³•äºŒï¼šä½¿ç”¨éƒ¨ç½²è„šæœ¬

```bash
cd /opt/colorful-tibet
./deploy.sh all
```

### 9.2 å¤‡ä»½æ•°æ®

#### å¤‡ä»½æ•°æ®åº“

```bash
# å¦‚æœä½¿ç”¨H2æ•°æ®åº“ï¼Œå¤‡ä»½æ•°æ®æ–‡ä»¶
cp -r /opt/colorful-tibet/data /opt/backup/data-$(date +%Y%m%d)

# å¦‚æœä½¿ç”¨MySQL
mysqldump -u tibet_user -p tibet_tourism > /opt/backup/tibet_tourism-$(date +%Y%m%d).sql
```

#### å¤‡ä»½é…ç½®æ–‡ä»¶

```bash
# å¤‡ä»½.envæ–‡ä»¶
cp /opt/colorful-tibet/.env /opt/backup/.env-$(date +%Y%m%d)
```

### 9.3 æŸ¥çœ‹æœåŠ¡çŠ¶æ€

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker compose ps

# æŸ¥çœ‹èµ„æºä½¿ç”¨
docker stats

# æŸ¥çœ‹æ—¥å¿—
docker compose logs --tail=50 -f
```

### 9.4 é‡å¯æœåŠ¡

```bash
# é‡å¯æ‰€æœ‰æœåŠ¡
docker compose restart

# é‡å¯ç‰¹å®šæœåŠ¡
docker compose restart backend
docker compose restart frontend

# å®Œå…¨åœæ­¢å¹¶é‡æ–°å¯åŠ¨
docker compose down
docker compose up -d
```

### 9.5 æ¸…ç†èµ„æº

```bash
# æ¸…ç†æœªä½¿ç”¨çš„é•œåƒ
docker image prune -a

# æ¸…ç†æœªä½¿ç”¨çš„å®¹å™¨å’Œç½‘ç»œ
docker system prune

# æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨çš„èµ„æºï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
docker system prune -a --volumes
```

### 9.6 ç›‘æ§å’Œæ—¥å¿—

#### è®¾ç½®æ—¥å¿—è½®è½¬

åˆ›å»ºæ—¥å¿—è½®è½¬é…ç½®ï¼š

```bash
sudo nano /etc/logrotate.d/colorful-tibet
```

æ·»åŠ ï¼š

```
/opt/colorful-tibet/logs/*.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0644 root root
}
```

#### ç›‘æ§æœåŠ¡å¥åº·

å¯ä»¥è®¾ç½®å®šæ—¶ä»»åŠ¡æ£€æŸ¥æœåŠ¡ï¼š

```bash
# ç¼–è¾‘crontab
crontab -e

# æ·»åŠ å¥åº·æ£€æŸ¥ï¼ˆæ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ï¼‰
*/5 * * * * curl -f http://localhost:8080/api/spots > /dev/null 2>&1 || docker compose restart backend
```

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. **æŸ¥çœ‹æ—¥å¿—**ï¼š`docker compose logs`
2. **æ£€æŸ¥æ–‡æ¡£**ï¼šæŸ¥çœ‹é¡¹ç›®ä¸­çš„å…¶ä»–æ–‡æ¡£
3. **æ£€æŸ¥GitHub Issues**ï¼šåœ¨é¡¹ç›®ä»“åº“ä¸­æœç´¢ç›¸å…³é—®é¢˜
4. **è”ç³»æŠ€æœ¯æ”¯æŒ**ï¼šæä¾›è¯¦ç»†çš„é”™è¯¯æ—¥å¿—å’Œé…ç½®ä¿¡æ¯

---

## âœ… éƒ¨ç½²æ£€æŸ¥æ¸…å•

éƒ¨ç½²å®Œæˆåï¼Œè¯·ç¡®è®¤ï¼š

- [ ] æœåŠ¡å™¨å·²è´­ä¹°å¹¶é…ç½®å®‰å…¨ç»„
- [ ] SSHå¯ä»¥æ­£å¸¸è¿æ¥
- [ ] Dockerå’ŒDocker Composeå·²å®‰è£…
- [ ] é¡¹ç›®ä»£ç å·²éƒ¨ç½²åˆ°æœåŠ¡å™¨
- [ ] `.env`æ–‡ä»¶å·²é…ç½®æ‰€æœ‰å¿…éœ€çš„ç¯å¢ƒå˜é‡
- [ ] æœåŠ¡å·²æˆåŠŸå¯åŠ¨ï¼ˆ`docker compose ps`æ˜¾ç¤ºUpçŠ¶æ€ï¼‰
- [ ] å‰ç«¯å¯ä»¥è®¿é—®ï¼ˆhttp://æœåŠ¡å™¨IPï¼‰
- [ ] åç«¯APIå¯ä»¥è®¿é—®ï¼ˆhttp://æœåŠ¡å™¨IP:8080/api/spotsï¼‰
- [ ] æ—¥å¿—ä¸­æ²¡æœ‰é”™è¯¯ä¿¡æ¯
- [ ] é˜²ç«å¢™å’Œå®‰å…¨ç»„å·²æ­£ç¡®é…ç½®
- [ ] ï¼ˆå¯é€‰ï¼‰åŸŸåå’ŒSSLè¯ä¹¦å·²é…ç½®

---

**ç¥æ‚¨éƒ¨ç½²é¡ºåˆ©ï¼** ğŸ‰

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒæœ¬æ–‡æ¡£çš„ã€Œå¸¸è§é—®é¢˜æ’æŸ¥ã€éƒ¨åˆ†ï¼Œæˆ–æŸ¥çœ‹é¡¹ç›®ä¸­çš„å…¶ä»–æ–‡æ¡£ã€‚

