# å‰ç«¯ç«¯å£æ˜ å°„é—®é¢˜è§£å†³

## âŒ é—®é¢˜ï¼šå‰ç«¯å®¹å™¨ PORTS åˆ—ä¸ºç©º

### é—®é¢˜æè¿°

æ‰§è¡Œ `docker compose ps` æ—¶ï¼Œå‰ç«¯å®¹å™¨æ˜¾ç¤ºï¼š
```
PORTS: (ç©º)
```

ä½† `docker-compose.yml` ä¸­å·²é…ç½®ï¼š
```yaml
ports:
  - "80:80"
```

### åŸå› 

- 80 ç«¯å£è¢«å…¶ä»–æœåŠ¡å ç”¨ï¼ˆé€šå¸¸æ˜¯ç³»ç»Ÿ nginxï¼‰
- å®¹å™¨å¯åŠ¨æ—¶ç«¯å£æ˜ å°„å¤±è´¥
- éœ€è¦é‡å¯å®¹å™¨

### è§£å†³æ–¹æ¡ˆ

#### æ­¥éª¤ 1ï¼šæ£€æŸ¥ç«¯å£å ç”¨

```bash
# æ£€æŸ¥ 80 ç«¯å£å ç”¨
sudo netstat -tlnp | grep :80

# æˆ–è€…ä½¿ç”¨ ss å‘½ä»¤
sudo ss -tlnp | grep :80
```

#### æ­¥éª¤ 2ï¼šåœæ­¢å ç”¨ç«¯å£çš„æœåŠ¡

```bash
# æ£€æŸ¥ç³»ç»Ÿ nginx
sudo systemctl status nginx

# å¦‚æœæ­£åœ¨è¿è¡Œï¼Œåœæ­¢å®ƒ
sudo systemctl stop nginx
sudo systemctl disable nginx

# æ£€æŸ¥æ˜¯å¦è¿˜æœ‰å…¶ä»–æœåŠ¡å ç”¨
sudo lsof -i :80
```

#### æ­¥éª¤ 3ï¼šé‡å¯å‰ç«¯å®¹å™¨

```bash
cd /opt/colorful-tibet

# åœæ­¢å‰ç«¯å®¹å™¨
docker compose stop frontend

# åˆ é™¤å‰ç«¯å®¹å™¨
docker compose rm -f frontend

# é‡æ–°å¯åŠ¨å‰ç«¯å®¹å™¨
docker compose up -d frontend

# æ£€æŸ¥çŠ¶æ€
docker compose ps
```

#### æ­¥éª¤ 4ï¼šå¦‚æœä»ç„¶å¤±è´¥ï¼Œå®Œå…¨é‡å¯

```bash
cd /opt/colorful-tibet

# åœæ­¢æ‰€æœ‰æœåŠ¡
docker compose down

# ç¡®ä¿ç«¯å£æœªè¢«å ç”¨
sudo netstat -tlnp | grep :80

# å¦‚æœç«¯å£ä»è¢«å ç”¨ï¼Œå¼ºåˆ¶åœæ­¢
sudo fuser -k 80/tcp

# é‡æ–°å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker compose up -d

# æ£€æŸ¥çŠ¶æ€
docker compose ps
```

## ğŸš€ å¿«é€Ÿä¿®å¤å‘½ä»¤

```bash
# 1. åœæ­¢ç³»ç»Ÿ nginx
sudo systemctl stop nginx
sudo systemctl disable nginx

# 2. æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tlnp | grep :80

# 3. å¦‚æœç«¯å£ä»è¢«å ç”¨ï¼Œå¼ºåˆ¶é‡Šæ”¾
sudo fuser -k 80/tcp

# 4. é‡å¯ Docker æœåŠ¡
cd /opt/colorful-tibet
docker compose down
docker compose up -d

# 5. æ£€æŸ¥çŠ¶æ€
docker compose ps

# 6. éªŒè¯ç«¯å£æ˜ å°„
docker port colorful-tibet-frontend
```

## ğŸ” éªŒè¯æ­¥éª¤

```bash
# 1. æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker compose ps
# å‰ç«¯å®¹å™¨çš„ PORTS åº”è¯¥æ˜¾ç¤ºï¼š0.0.0.0:80->80/tcp

# 2. æ£€æŸ¥ç«¯å£æ˜ å°„
docker port colorful-tibet-frontend
# åº”è¯¥æ˜¾ç¤ºï¼š80/tcp -> 0.0.0.0:80

# 3. æ£€æŸ¥ç«¯å£ç›‘å¬
sudo netstat -tlnp | grep :80
# åº”è¯¥æ˜¾ç¤º Docker å®¹å™¨åœ¨ç›‘å¬

# 4. æµ‹è¯•è®¿é—®
curl -I http://localhost
# åº”è¯¥è¿”å› HTTP 200
```

## âš ï¸ å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šç«¯å£è¢«ç³»ç»Ÿ nginx å ç”¨

```bash
# å®Œå…¨åœæ­¢ç³»ç»Ÿ nginx
sudo systemctl stop nginx
sudo systemctl disable nginx
sudo pkill nginx

# é‡å¯ Docker æœåŠ¡
docker compose restart frontend
```

### é—®é¢˜ 2ï¼šç«¯å£è¢«å…¶ä»– Docker å®¹å™¨å ç”¨

```bash
# æŸ¥çœ‹æ‰€æœ‰ Docker å®¹å™¨
docker ps -a

# æŸ¥çœ‹ç«¯å£å ç”¨
docker ps --format "table {{.Names}}\t{{.Ports}}"

# åœæ­¢å ç”¨ç«¯å£çš„å®¹å™¨
docker stop <container-name>
```

### é—®é¢˜ 3ï¼šDocker ç½‘ç»œé—®é¢˜

```bash
# æ£€æŸ¥ Docker ç½‘ç»œ
docker network ls
docker network inspect colorful-tibet_default

# é‡æ–°åˆ›å»ºç½‘ç»œ
docker compose down
docker network prune -f
docker compose up -d
```

## ğŸ“ å®Œæ•´ä¿®å¤æµç¨‹

```bash
# 1. åœæ­¢æ‰€æœ‰å¯èƒ½å ç”¨ 80 ç«¯å£çš„æœåŠ¡
sudo systemctl stop nginx
sudo systemctl disable nginx
sudo pkill nginx 2>/dev/null

# 2. æ£€æŸ¥å¹¶å¼ºåˆ¶é‡Šæ”¾ç«¯å£
sudo fuser -k 80/tcp 2>/dev/null

# 3. é‡å¯ Docker æœåŠ¡
cd /opt/colorful-tibet
docker compose down
docker compose up -d

# 4. ç­‰å¾…æœåŠ¡å¯åŠ¨
sleep 5

# 5. æ£€æŸ¥çŠ¶æ€
docker compose ps

# 6. éªŒè¯ç«¯å£æ˜ å°„
docker port colorful-tibet-frontend

# 7. æµ‹è¯•è®¿é—®
curl -I http://localhost
```

## ğŸ¯ æˆåŠŸæ ‡å¿—

ä¿®å¤æˆåŠŸåï¼š
- `docker compose ps` æ˜¾ç¤ºå‰ç«¯å®¹å™¨çš„ PORTS ä¸ºï¼š`0.0.0.0:80->80/tcp`
- `docker port colorful-tibet-frontend` æ˜¾ç¤ºç«¯å£æ˜ å°„
- `sudo netstat -tlnp | grep :80` æ˜¾ç¤º Docker å®¹å™¨åœ¨ç›‘å¬
- æµè§ˆå™¨è®¿é—® `http://1.15.29.168` æ˜¾ç¤ºé¡¹ç›®é¡µé¢

