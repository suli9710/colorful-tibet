# è§£å†³ SCP æƒé™é—®é¢˜ - æœ€ç»ˆæ–¹æ¡ˆ

## ğŸ” é—®é¢˜åˆ†æ

é”™è¯¯ï¼š`scp: dest open "/tmp/server-setup.sh": Permission denied`

è¿™è¯´æ˜ï¼š
- âœ… å¯†ç å·²ç»æ­£ç¡®ï¼ˆå¦åˆ™ä¼šæç¤º"Permission denied, please try again"ï¼‰
- âŒ ä½†æ˜¯ ubuntu ç”¨æˆ·æ²¡æœ‰æƒé™å†™å…¥ `/tmp` ç›®å½•

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šä¸Šä¼ åˆ°ç”¨æˆ·å®¶ç›®å½•ï¼ˆæ¨èï¼‰

åœ¨CMDä¸­æ‰§è¡Œï¼š

```cmd
scp C:\Users\Suli\Desktop\colorful-tibet\server-setup.sh ubuntu@1.15.29.168:~/
```

æ³¨æ„ï¼šæœ€åæ˜¯ `~/` è€Œä¸æ˜¯ `/tmp/`ï¼Œè¿™ä¼šä¸Šä¼ åˆ°ç”¨æˆ·å®¶ç›®å½• `/home/ubuntu/`

ç„¶ååœ¨æœåŠ¡å™¨ç»ˆç«¯æ‰§è¡Œï¼š

```bash
# ç§»åŠ¨åˆ°tmpç›®å½•ï¼ˆéœ€è¦sudoæƒé™ï¼‰
sudo mv ~/server-setup.sh /tmp/server-setup.sh

# èµ‹äºˆæ‰§è¡Œæƒé™
sudo chmod +x /tmp/server-setup.sh

# æ‰§è¡Œå®‰è£…
sudo bash /tmp/server-setup.sh
```

### æ–¹æ¡ˆ2ï¼šç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºè„šæœ¬ï¼ˆæœ€ç®€å•ï¼‰

æ—¢ç„¶ä¸Šä¼ æœ‰æƒé™é—®é¢˜ï¼Œç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºè„šæœ¬ï¼š

**æ­¥éª¤1ï¼šç™»å½•è…¾è®¯äº‘Webç»ˆç«¯**

**æ­¥éª¤2ï¼šå¤åˆ¶å¹¶æ‰§è¡Œä»¥ä¸‹å‘½ä»¤**

```bash
cat > /tmp/server-setup.sh << 'EOF'
#!/bin/bash
set -e
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'
log_info() { echo -e "${GREEN}[INFO]${NC} $1"; }
log_warn() { echo -e "${YELLOW}[WARN]${NC} $1"; }
log_error() { echo -e "${RED}[ERROR]${NC} $1"; }
log_step() { echo -e "${BLUE}[STEP]${NC} $1"; }
if [ "$EUID" -ne 0 ]; then 
    log_error "è¯·ä½¿ç”¨rootæƒé™è¿è¡Œæ­¤è„šæœ¬"
    exit 1
fi
log_info "========================================="
log_info "  æœåŠ¡å™¨ç¯å¢ƒä¸€é”®å®‰è£…è„šæœ¬"
log_info "========================================="
log_step "1. æ›´æ–°ç³»ç»ŸåŒ…..."
apt update && apt upgrade -y
log_step "2. å®‰è£…åŸºç¡€å·¥å…·..."
apt install -y curl wget git vim nano htop ufw
log_step "3. å®‰è£…Java 17..."
apt install -y openjdk-17-jdk
java -version
log_info "Javaå®‰è£…å®Œæˆ"
log_step "4. å®‰è£…Maven..."
apt install -y maven
mvn -version
log_info "Mavenå®‰è£…å®Œæˆ"
log_step "5. å®‰è£…MySQL..."
apt install -y mysql-server
sleep 5
if systemctl list-units --type=service | grep -q "mysql.service"; then
    systemctl start mysql
    systemctl enable mysql
elif systemctl list-units --type=service | grep -q "mysqld.service"; then
    systemctl start mysqld
    systemctl enable mysqld
else
    service mysql start || service mysqld start || true
fi
sleep 5
if ! pgrep -x mysqld > /dev/null; then
    log_warn "MySQLæœåŠ¡æœªè¿è¡Œï¼Œå°è¯•æ‰‹åŠ¨å¯åŠ¨..."
    mysqld_safe --user=mysql &
    sleep 5
fi
MYSQL_ROOT_PASSWORD=$(openssl rand -base64 32)
log_warn "MySQL rootå¯†ç : $MYSQL_ROOT_PASSWORD"
log_warn "è¯·ä¿å­˜æ­¤å¯†ç ï¼"
sudo mysql -e "ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '${MYSQL_ROOT_PASSWORD}';" 2>/dev/null || \
mysql -u root -e "ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '${MYSQL_ROOT_PASSWORD}';" 2>/dev/null || \
mysql -e "ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '${MYSQL_ROOT_PASSWORD}';"
sudo mysql -e "DELETE FROM mysql.user WHERE User='';" 2>/dev/null || \
mysql -u root -e "DELETE FROM mysql.user WHERE User='';" 2>/dev/null || \
mysql -e "DELETE FROM mysql.user WHERE User='';"
sudo mysql -e "DELETE FROM mysql.user WHERE User='root' AND Host NOT IN ('localhost', '127.0.0.1', '::1');" 2>/dev/null || \
mysql -u root -e "DELETE FROM mysql.user WHERE User='root' AND Host NOT IN ('localhost', '127.0.0.1', '::1');" 2>/dev/null || \
mysql -e "DELETE FROM mysql.user WHERE User='root' AND Host NOT IN ('localhost', '127.0.0.1', '::1');"
sudo mysql -e "DROP DATABASE IF EXISTS test;" 2>/dev/null || \
mysql -u root -e "DROP DATABASE IF EXISTS test;" 2>/dev/null || \
mysql -e "DROP DATABASE IF EXISTS test;"
sudo mysql -e "DELETE FROM mysql.db WHERE Db='test' OR Db='test\\_%';" 2>/dev/null || \
mysql -u root -e "DELETE FROM mysql.db WHERE Db='test' OR Db='test\\_%';" 2>/dev/null || \
mysql -e "DELETE FROM mysql.db WHERE Db='test' OR Db='test\\_%';"
sudo mysql -e "FLUSH PRIVILEGES;" 2>/dev/null || \
mysql -u root -e "FLUSH PRIVILEGES;" 2>/dev/null || \
mysql -e "FLUSH PRIVILEGES;"
log_info "MySQLå®‰è£…å®Œæˆ"
log_step "6. å®‰è£…Node.js 18..."
curl -fsSL https://deb.nodesource.com/setup_18.x | bash -
apt install -y nodejs
node -v
npm -v
log_info "Node.jså®‰è£…å®Œæˆ"
log_step "7. å®‰è£…Nginx..."
apt install -y nginx
systemctl start nginx
systemctl enable nginx
log_info "Nginxå®‰è£…å®Œæˆ"
log_step "8. å®‰è£…PM2..."
npm install -g pm2
log_info "PM2å®‰è£…å®Œæˆ"
log_step "9. å®‰è£…Certbot..."
apt install -y certbot python3-certbot-nginx
log_info "Certbotå®‰è£…å®Œæˆ"
log_step "10. é…ç½®é˜²ç«å¢™..."
ufw --force enable
ufw allow 22/tcp
ufw allow 80/tcp
ufw allow 443/tcp
log_info "é˜²ç«å¢™é…ç½®å®Œæˆ"
log_step "11. åˆ›å»ºé¡¹ç›®ç›®å½•..."
mkdir -p /opt/colorful-tibet/{logs,backups,uploads}
log_info "é¡¹ç›®ç›®å½•åˆ›å»ºå®Œæˆ"
log_step "12. åˆ›å»ºæ•°æ®åº“..."
read -p "è¯·è¾“å…¥æ•°æ®åº“ç”¨æˆ·å¯†ç ï¼ˆç•™ç©ºå°†è‡ªåŠ¨ç”Ÿæˆï¼‰: " DB_PASSWORD
if [ -z "$DB_PASSWORD" ]; then
    DB_PASSWORD=$(openssl rand -base64 16)
    log_warn "æ•°æ®åº“ç”¨æˆ·å¯†ç : $DB_PASSWORD"
fi
mysql -u root -p${MYSQL_ROOT_PASSWORD} <<MYSQL_EOF
CREATE DATABASE IF NOT EXISTS tibet_tourism CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER IF NOT EXISTS 'tibet_user'@'localhost' IDENTIFIED BY '${DB_PASSWORD}';
GRANT ALL PRIVILEGES ON tibet_tourism.* TO 'tibet_user'@'localhost';
FLUSH PRIVILEGES;
MYSQL_EOF
log_info "æ•°æ®åº“åˆ›å»ºå®Œæˆ"
log_step "13. ä¿å­˜é…ç½®ä¿¡æ¯..."
cat > /opt/colorful-tibet/server-info.txt <<INFO_EOF
=========================================
æœåŠ¡å™¨ç¯å¢ƒå®‰è£…å®Œæˆ
=========================================
MySQL rootå¯†ç : ${MYSQL_ROOT_PASSWORD}
æ•°æ®åº“ç”¨æˆ·: tibet_user
æ•°æ®åº“å¯†ç : ${DB_PASSWORD}
æ•°æ®åº“å: tibet_tourism
è¯·å¦¥å–„ä¿ç®¡ä»¥ä¸Šä¿¡æ¯ï¼
å®‰è£…çš„è½¯ä»¶ç‰ˆæœ¬:
- Java: $(java -version 2>&1 | head -n 1)
- Maven: $(mvn -version | head -n 1)
- Node.js: $(node -v)
- npm: $(npm -v)
- MySQL: $(mysql --version)
- Nginx: $(nginx -v 2>&1)
ä¸‹ä¸€æ­¥:
1. ä¸Šä¼ é¡¹ç›®ä»£ç åˆ° /opt/colorful-tibet/
2. é…ç½® application.yml
3. ç¼–è¯‘å¹¶å¯åŠ¨åç«¯æœåŠ¡
4. æ„å»ºå‰ç«¯å¹¶é…ç½®Nginx
5. é…ç½®åŸŸåå’ŒSSLè¯ä¹¦
è¯¦ç»†æ­¥éª¤è¯·å‚è€ƒ: DEPLOYMENT_GUIDE.md
=========================================
INFO_EOF
log_info "é…ç½®ä¿¡æ¯å·²ä¿å­˜åˆ°: /opt/colorful-tibet/server-info.txt"
log_info "========================================="
log_info "  å®‰è£…å®Œæˆï¼"
log_info "========================================="
log_warn "è¯·æŸ¥çœ‹ /opt/colorful-tibet/server-info.txt è·å–é‡è¦ä¿¡æ¯"
log_info "ä¸‹ä¸€æ­¥è¯·å‚è€ƒ DEPLOYMENT_GUIDE.md è¿›è¡Œé¡¹ç›®éƒ¨ç½²"
EOF
```

**æ­¥éª¤3ï¼šæ‰§è¡Œè„šæœ¬**

```bash
chmod +x /tmp/server-setup.sh
sudo bash /tmp/server-setup.sh
```

### æ–¹æ¡ˆ3ï¼šä½¿ç”¨WinSCPï¼ˆå›¾å½¢ç•Œé¢ï¼‰

1. ä¸‹è½½WinSCPï¼šhttps://winscp.net/
2. è¿æ¥æœåŠ¡å™¨ï¼ˆä½¿ç”¨ubuntuç”¨æˆ·ï¼‰
3. ä¸Šä¼ æ–‡ä»¶åˆ° `/home/ubuntu/` ç›®å½•ï¼ˆç”¨æˆ·å®¶ç›®å½•ï¼Œæœ‰å†™å…¥æƒé™ï¼‰
4. åœ¨æœåŠ¡å™¨ç»ˆç«¯æ‰§è¡Œï¼š
   ```bash
   sudo mv ~/server-setup.sh /tmp/server-setup.sh
   sudo chmod +x /tmp/server-setup.sh
   sudo bash /tmp/server-setup.sh
   ```

## ğŸ¯ æ¨èæ–¹æ¡ˆ

**æœ€æ¨èï¼šæ–¹æ¡ˆ2ï¼ˆç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºè„šæœ¬ï¼‰**
- âœ… ä¸éœ€è¦ä¸Šä¼ æ–‡ä»¶
- âœ… ä¸éœ€è¦å¤„ç†æƒé™é—®é¢˜
- âœ… ç›´æ¥åœ¨ç»ˆç«¯å¤åˆ¶ç²˜è´´å³å¯
- âœ… æœ€ç®€å•å¯é 

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ–¹æ¡ˆ2ä¸­çš„å‘½ä»¤å¾ˆé•¿**ï¼Œéœ€è¦å®Œæ•´å¤åˆ¶ä» `cat >` åˆ°æœ€åçš„ `EOF`
2. **EOF å¿…é¡»å•ç‹¬ä¸€è¡Œ**ï¼Œå‰åä¸èƒ½æœ‰å…¶ä»–å­—ç¬¦
3. **æ‰§è¡Œæ—¶ä½¿ç”¨ sudo**ï¼Œå› ä¸ºéœ€è¦rootæƒé™

---

**å»ºè®®ï¼šç›´æ¥ä½¿ç”¨æ–¹æ¡ˆ2ï¼Œåœ¨æœåŠ¡å™¨ç»ˆç«¯ä¸­åˆ›å»ºè„šæœ¬ï¼Œè¿™æ˜¯æœ€ç®€å•çš„æ–¹æ³•ï¼**


