# 深度融合协同过滤推荐算法

## 📊 算法概述

本项目实现了**深度融合协同过滤推荐算法**（Deep Collaborative Filtering），结合了神经网络嵌入、深度学习和传统协同过滤技术，为旅游景点推荐提供智能化的个性化服务。

## 🧠 核心特性

### 1. **神经网络嵌入层（Embedding Layer）**
- 将用户和景点映射到低维向量空间（默认16维）
- 学习用户和景点的潜在特征表示
- 使用Xavier初始化方法，确保训练稳定性

### 2. **深度神经网络（Deep Neural Network）**
- 多层全连接网络（默认：32 → 16 → 1）
- ReLU激活函数（隐藏层）
- Sigmoid激活函数（输出层）
- 学习用户-景点交互的复杂非线性模式

### 3. **注意力机制（Attention Mechanism）**
- **维度注意力（Dimension-wise Attention）**：学习特征维度的重要性权重
- **交互感知**：根据用户和景点的交互（逐元素积）动态调整权重
- **自适应加权**：自动关注对推荐结果更重要的特征维度

### 4. **矩阵分解（Matrix Factorization）**
- 通过嵌入向量学习用户和景点的潜在因子
- 预测用户对未访问景点的评分

### 5. **特征工程（Feature Engineering）**

- **用户特征**：
  - 偏好标签（基于历史评分）
  - 平均评分
  - 评分数量
  - 偏好海拔
  - 偏好地区
- **景点特征**：
  - 标签
  - 海拔
  - 位置
  - 热度（基于访问流量）
  - 平均评分

### 6. **多任务学习（Multi-task Learning）**
- **双任务架构**：同时学习评分预测和推荐分类
- **共享表示**：通过共享底层特征，两个任务互相促进
- **加权损失**：评分预测 60% + 推荐分类 40%
- **自动标签**：评分 ≥ 4.5 视为推荐，否则为不推荐

### 7. **混合推荐（Hybrid Recommendation）**
- **协同过滤**（70%权重）：基于相似用户的行为
- **内容过滤**（30%权重）：基于景点特征和用户偏好匹配
- 有效解决冷启动问题

## 🔧 算法架构

```
用户嵌入 (16维) ─┐
                 ├─→ 交互 (16维) ─→ 注意力权重 (16维)
景点嵌入 (16维) ─┘        │                 │
                          ▼                 ▼
                 加权用户嵌入 + 加权景点嵌入 (32维)
                          │
                          ▼
                     共享隐藏层
                     (32→16)
                          │
                    ┌─────┼─────┐
                    ▼           ▼
                任务1       任务2
              评分预测    推荐分类
              (16→1)    (16→1)
                │           │
                ▼           ▼
              1-5分      0-1概率
                │           │
                └───┬───┘
                    ▼
               最终推荐分数
```



### 训练流程

1. **初始化**：随机初始化嵌入向量和网络权重
2. **前向传播**：计算预测评分
3. **反向传播**：计算梯度并更新参数
4. **迭代优化**：重复训练直到收敛

## 📈 算法优势

### 相比传统协同过滤：

1. **更强的表达能力**：深度神经网络可以学习复杂的非线性关系
2. **更好的泛化能力**：通过嵌入层学习潜在特征，减少过拟合
3. **特征融合**：自动学习用户和景点的特征表示
4. **冷启动处理**：结合内容过滤，为新用户提供推荐

### 性能优化：

- 减少嵌入维度（16维而非32维）
- 简化网络结构（2层隐藏层）
- 减少训练轮数（20轮）
- 提高学习率（0.05）以加快收敛

## 🚀 使用方法

### 基本用法

```typescript
import { getDeepRecommendations } from './services/deepCollaborativeFiltering';

// 获取推荐
const recommendations = getDeepRecommendations(
  'current_user',  // 用户ID
  destinations,    // 所有景点列表
  userRatings,    // 用户评分（可选）
  userBehaviors   // 用户行为数据（可选）
);

// 推荐结果
recommendations.forEach(rec => {
  console.log(`${rec.destination.name}: ${rec.score.toFixed(1)}分`);
  console.log(`推荐理由: ${rec.reason}`);
});
```

### 高级用法

```typescript
import { DeepCollaborativeFiltering } from './services/deepCollaborativeFiltering';

// 创建推荐系统实例
const recommender = new DeepCollaborativeFiltering(
  userBehaviors,
  destinations,
  {
    embeddingDim: 16,      // 嵌入维度
    hiddenLayers: [32, 16], // 隐藏层结构
    learningRate: 0.05,     // 学习率
    epochs: 20,             // 训练轮数
  }
);

// 预测评分
const rating = recommender.predictRating('user_1', 'dest_1');

// 获取推荐
const recommendations = recommender.getRecommendations('user_1', userRatings, 5);
```

## 📊 推荐结果格式

```typescript
{
  destination: Destination,  // 景点对象
  score: number,             // 推荐分数（1-5分）
  reason: string             // 推荐理由
}
```

### 推荐理由示例：

- "与您的偏好高度匹配"
- "符合您的兴趣标签"
- "热门景点"
- "值得探索的景点"

## ⚙️ 配置参数

| 参数 | 默认值 | 说明 |
|------|--------|------|
| `embeddingDim` | 16 | 嵌入向量维度 |
| `hiddenLayers` | [32, 16] | 隐藏层结构 |
| `learningRate` | 0.05 | 学习率 |
| `epochs` | 20 | 训练轮数 |

## 🎯 应用场景

1. **个性化推荐**：根据用户历史行为推荐景点
2. **冷启动处理**：为新用户提供基于内容的推荐
3. **相似用户发现**：找到具有相似偏好的用户群体
4. **评分预测**：预测用户对未访问景点的评分

## 🧊 冷启动解决方案

### 问题描述
当新用户注册或用户没有历史评分数据时，协同过滤算法无法工作，这就是"冷启动"问题。

### 解决方案
系统采用**多维度内容过滤**策略，综合考虑以下因素：

#### 1. **热门度（40%权重）**
- 基于景点的访问流量数据（`visitorFlow`）
- 计算平均访问量作为热门度指标
- 确保推荐的是被广泛认可的景点

#### 2. **多样性（30%权重）**
- 基于景点的标签数量（`tags`）
- 确保推荐列表包含不同类型的景点
- 避免推荐结果过于单一

#### 3. **平均评分（20%权重）**
- 基于其他用户的历史评分
- 计算每个景点的平均评分
- 优先推荐高评分景点

#### 4. **新鲜度（10%权重）**
- 为非最热门景点提供加成
- 增加推荐的探索性
- 避免只推荐最热门的几个景点

### 多样性保证机制
系统会确保推荐列表的多样性：
- 优先选择不同标签类型的景点
- 如果前60%的推荐都是同一类型，会主动加入不同类型的景点
- 最终确保推荐列表覆盖多种景点类型

### 推荐理由生成
冷启动推荐的推荐理由包括：
- "热门景点"：访问量高的景点
- "高评分"：其他用户评分≥4.5的景点
- "类型丰富"：具有多个标签的景点
- "值得探索"：综合评分较高的景点

### 示例
```typescript
// 新用户（无评分历史）
const recommendations = recommender.getRecommendations('new_user', {}, 5);

// 返回结果示例：
[
  {
    destination: { name: '布达拉宫', ... },
    score: 4.8,
    reason: '新用户推荐：热门景点、高评分'
  },
  {
    destination: { name: '纳木错', ... },
    score: 4.5,
    reason: '新用户推荐：热门景点、类型丰富'
  },
  // ...
]
```

### 优势
1. **无需用户数据**：即使新用户也能立即获得推荐
2. **多样性保证**：推荐结果不会过于单一
3. **质量保证**：综合考虑热门度和评分，确保推荐质量
4. **探索性**：适当引入非最热门景点，增加探索乐趣

## 📝 技术细节

### 激活函数

- **ReLU**：`f(x) = max(0, x)` - 用于隐藏层
- **Sigmoid**：`f(x) = 1 / (1 + e^(-x))` - 用于输出层

### 损失函数

使用均方误差（MSE）作为损失函数：
```
Loss = (预测评分 - 真实评分)²
```

### 优化算法

使用梯度下降法更新参数：
```
θ = θ - α * ∇θ Loss
```

其中：
- `θ`：参数（权重和偏置）
- `α`：学习率
- `∇θ Loss`：损失函数的梯度

## 🔍 算法流程

1. **数据准备**：收集用户评分和景点数据
2. **特征提取**：提取用户和景点特征
3. **模型训练**：训练深度神经网络
4. **评分预测**：预测用户对未访问景点的评分
5. **推荐生成**：结合协同过滤和内容过滤生成推荐
6. **结果排序**：按推荐分数排序并返回Top-K结果

## 💡 未来优化方向

1. **在线学习**：支持增量更新，无需重新训练整个模型
2. **注意力机制**：引入注意力机制，关注重要的用户-景点交互
3. **图神经网络**：使用GNN建模用户-景点关系图
4. **多任务学习**：同时预测评分和推荐，提升模型性能
5. **强化学习**：使用RL优化长期用户满意度

## 📚 参考文献

- Neural Collaborative Filtering (He et al., 2017)
- Deep Learning for Recommender Systems (Zhang et al., 2019)
- Wide & Deep Learning for Recommender Systems (Cheng et al., 2016)

